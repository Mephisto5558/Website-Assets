document.querySelector("#sudoku").addEventListener("keypress",e=>{if(" "==e.key&&(e.target.value=""),!/[1-9]/.test(e.key))return e.preventDefault();e.target.value&&(e.preventDefault(),e.target.value=e.key)}),document.documentElement.removeAttribute("style");let cells=[...document.querySelectorAll("#sudoku > tbody > tr > td")].reduce((t,a)=>{for(let e=0,r=["group","col","row"];e<r.length;e++){var o=Number(a.firstChild.dataset[r[e]])-1;t[e][o]??=[],t[e][o].type??=r[e],t[e][o].push(a)}return t},[[],[],[]]).flat();function checkErrors(){for(var e of cells){var r=e[0].firstChild.dataset[e.type]-1,r="row"==e.type||"col"==e.type?[document.querySelectorAll("#sudoku > tbody > tr").item(r)]:document.querySelectorAll(`#sudoku > tbody > tr > td:has(input[data-group='${1+r}']`),e=e.map(e=>Number(e.firstChild.value)||void 0);if(!e.includes(void 0)&&e.length>new Set(e).size)for(var t of r)t.classList.add("error");else for(var a of r)a.classList.remove("error")}}function generateSudoku(e=9,r=40){var t=Math.sqrt(e);if(!Number.isInteger(t))throw new Error("Size must be quadratic.");globalThis.boardSize=e;var a=Array.from({length:e},()=>Array.from({length:e},()=>0)),o=(fill(a,t),a.map(e=>[...e]));let d=0,l=0;for(;d<r&&l++<e*e*5;){var i=rando(0,e-1),u=rando(0,e-1);if(0!==o[i][u]){var s=o[i][u];let e=o[i][u]=0;solve(o.map(e=>[...e]),t,()=>1<++e),1==e?d++:o[i][u]=s}}displayBoard(o)}function fill(e,r,t=0,a=0){if(t==boardSize)return!0;for(var o of randoSequence(1,boardSize))if(!isUnsafe(e,r,t,a,o)){e[t][a]=o;var[o,d]=a+1==boardSize?[t+1,0]:[t,a+1];if(fill(e,r,o,d))return!0;e[t][a]=0}return!1}function solve(r,t,a,o=0,d=0){if(o==boardSize)return!0;var[l,i]=d+1==boardSize?[o+1,0]:[o,d+1];if(r[o][d])return solve(r,t,a,l,i);for(let e=1;e<=boardSize;e++)if(!isUnsafe(r,t,o,d,e)){if(r[o][d]=e,solve(r,t,a,l,i)&&a?.())return!0;r[o][d]=0}return!1}function isUnsafe(r,t,a,o,d){for(let e=0;e<boardSize;e++){if(r[a][e]==d||r[e][o]==d)return!0;var l=t*Math.floor(a/t)+Math.floor(e/t),i=t*Math.floor(o/t)+e%t;if(r[l][i]==d)return!0}return!1}globalThis.checkWinInterval=setInterval(checkErrors,1e3);let htmlBoard=[...document.querySelectorAll("#sudoku > tbody > tr")].map(e=>[...e.children].map(e=>e.firstChild));function displayBoard(e){for(var r of htmlBoard.flat())e[r.dataset.row-1][r.dataset.col-1]&&(r.value=e[r.dataset.row-1][r.dataset.col-1],r.disabled=!0)}generateSudoku(),document.querySelector("#sudoku").addEventListener("keydown",a=>{let o=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab"];function r(e=0,r=0){let t;switch(a.key){case o[0]:t=htmlBoard[0==e?boardSize-1:e-1][r];break;case o[1]:t=htmlBoard[e==boardSize-1?0:e+1][r];break;case o[2]:t=htmlBoard[e][0==r?boardSize-1:r-1];break;case o[3]:t=htmlBoard[e][r==boardSize-1?0:r+1];break;case o[4]:a.shiftKey?t=0==r&&0==e?htmlBoard[boardSize-1][boardSize-1]:0==r?htmlBoard[e-1][boardSize-1]:htmlBoard[boardSize-1][r-1]:t=r==boardSize-1&&e==boardSize-1?htmlBoard[0][0]:r==boardSize-1?htmlBoard[e+1][0]:htmlBoard[e][r+1]}return t}if(o.includes(a.key)){a.preventDefault();let e=r(Number(a.target.dataset.row)-1,Number(a.target.dataset.col)-1);for(;e.disabled&&((e=r(Number(e.dataset.row)-1,Number(e.dataset.col)-1)).dataset.row!=a.target.dataset.row||e.dataset.col!=a.target.dataset.col););e?.focus()}});