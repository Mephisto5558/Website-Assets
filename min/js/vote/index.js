"use strict";(()=>{function a(e,t,r,n=!1){let i=document.createElement(e);if(t)for(let s of Object.keys(t)){let c=t[s];c!==void 0&&(typeof c=="object"&&c!=null&&!Array.isArray(c)&&s in i?Object.assign(i[s],c):i[s]=c)}return r&&(n?r.replaceChildren(i):r.append(i)),i}var q=403,P=200,x=140,S=4e3,M=39,b=16;var R=300,g=1e3,h={columnMode:"cards-column-mode",rowMode:"cards-row-mode"},m=document.body.querySelector("#header-container"),d=document.body.querySelector("#cards-container"),u=document.body.querySelector("#cards-container-pending"),T=document.body.querySelector("#feature-request-overlay"),y=a("input",{type:"text",placeholder:"Search",id:"search-box",value:new URLSearchParams(globalThis.location.search).get("q")??"",className:"grey-hover",maxLength:P});var k={cardsCache:new Map,user:void 0,cardsOffset:0,pageIsLoaded:!1,smallScreen:!1},o=k;function L(e,t){let r;return async(...n)=>new Promise((i,s)=>{clearTimeout(r),r=setTimeout(()=>{try{i(e(...n))}catch(c){s(c instanceof Error?c:new Error(c))}},t)})}var _=L(async(e,t)=>{if(!o.user?.id)return void Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to vote!"});let r=await f("vote/addvote",{method:"POST",body:JSON.stringify({featureId:e})});try{r=await r.json()}catch{}if(r.ok===!1||r.error)return void Swal.fire({icon:"error",title:"Oops...",text:r.error??r.statusText});Swal.fire({icon:"success",title:"Success",text:"Your vote has been successfully recorded."});let n=o.cardsCache.get(e);n.votes=(n.votes??0)+1,t.textContent=n.votes.toLocaleString(),o.cardsOffset=0,p()},g);async function f(e,t={},r=5e3){t.body!=null&&!t.headers&&(t.headers={"Content-Type":"application/json"});let n=new AbortController;t.signal=n.signal;let i=setTimeout(()=>n.abort("Request timed out"),r);return await fetch(`/api/v1/internal/${e}`,t).finally(()=>clearTimeout(i))}async function w(){let e=new Map((await f(`vote/list?includePending=${!!o.user?.dev}`).then(t=>t.json()))?.cards?.toSorted((t,r)=>!t.pending&&r.pending?1:t.pending&&!r.pending?-1:(r.votes??0)-(t.votes??0)||t.title.localeCompare(r.title)).map(t=>[t.id,t]));o.cardsCache.clear();for(let[t,r]of e)o.cardsCache.set(t,r)}function D(e,t){let r=new URL(globalThis.location.href),n=new URLSearchParams(globalThis.location.search);t?n.set(e,t):n.delete(e),r.search=n.toString(),globalThis.history.pushState(void 0,"",r.toString())}function p(e=y.value,t=26){e=e.toLowerCase(),D("q",e);let r=e?[...o.cardsCache.values()].filter(n=>n.title.toLowerCase().includes(e)||n.body?.toLowerCase().includes(e)||n.id.toLowerCase().includes(e)):[...o.cardsCache.values()];if(!r.length&&!d.childElementCount&&!u.childElementCount)return void a("h2",{textContent:`There are currently no feature requests${e?" matching your search query":""} :(`},d,!0);o.cardsOffset||(d.innerHTML="",u.innerHTML="");for(let n of r.slice(o.cardsOffset,t+o.cardsOffset))B(n);return o.cardsOffset+=t,o.cardsCache.size>o.cardsOffset&&(d.childElementCount+u.childElementCount<t?p(e,t):d.clientHeight<window.innerHeight&&p(e,Math.ceil((window.innerHeight-d.clientHeight)/(d.clientHeight/d.childElementCount)))),r}function B(e){let t=!!o.user?.dev,r=a("div",{className:"card",id:e.id}),n=a("h2",{id:"title",textContent:e.title,contentEditable:t?"plaintext-only":"false"},r),i=e.body||t?a("p",{id:"description",textContent:e.body??"",contentEditable:t?"plaintext-only":"false"},r):void 0,s=a("div",{className:"vote-buttons"},r),c=a("span",{className:"vote-counter",textContent:e.pending?"":(e.votes??0).toString()});e.pending&&t?a("button",{textContent:"Approve",className:"vote-button blue-button"},s).addEventListener("click",async()=>{let l=await f("vote/approve",{method:"POST",body:JSON.stringify({featureId:e.id})}).then(C=>C.json()).catch(C=>C);if(l.ok===!1||l.error)return void Swal.fire({icon:"error",title:"Oops...",text:l.error??l.statusText});Swal.fire({icon:"success",title:"Success",text:"The feature request has been approved."}),d.append(r),u.childElementCount||(document.body.querySelector("#new-requests")?.remove(),document.body.querySelector("#old-requests")?.remove(),document.body.querySelector("#feature-request-overlay + *").style.marginTop=`${m.clientHeight+b}px`)}):e.pending||a("button",{className:"vote-button blue-button",textContent:"Upvote"},s).addEventListener("click",async()=>_(e.id,c)),s.append(c);let I=a("button",{title:"Copy card Id",className:"manage-button grey-hover"},s),N=a("i",{className:"far fa-copy fa-xl"},I);if(I.addEventListener("click",()=>{navigator.clipboard.writeText(e.id),N.classList="fas fa-check fa-xl",setTimeout(()=>N.classList="far fa-copy fa-xl",g*3)}),t&&(n.addEventListener("keydown",l=>{!(l.target instanceof HTMLElement)||!(l.target.parentElement instanceof HTMLElement)||(l.target.parentElement.hasAttribute("modified")?l.target.textContent==e.title&&l.target.parentElement.removeAttribute("modified"):l.target.textContent!=e.title&&l.target.parentElement.setAttribute("modified",""),l.key==="Enter"&&(l.preventDefault(),l.target.nextElementSibling.firstElementChild.focus()))}),i?.addEventListener("input",l=>{!(l.target instanceof HTMLElement)||!(l.target.parentElement instanceof HTMLElement)||(l.target.parentElement.hasAttribute("modified")?l.target.textContent==e.body&&l.target.parentElement.removeAttribute("modified"):l.target.textContent!=e.body&&l.target.parentElement.setAttribute("modified",""))})),t||o.user?.id==e.id.split("_")[0]){let l=a("button",{title:"Delete card",className:"manage-button grey-hover"},s);l.addEventListener("click",async()=>Swal.fire({icon:"warning",title:"Are you sure?",text:"Are you sure you want to delete that card? This action cannot be undone!",showCancelButton:!0,preConfirm:async()=>{await f("vote/delete",{method:"DELETE",body:JSON.stringify({featureId:e.id})}),r.remove(),u.childElementCount||(document.body.querySelector("#new-requests")?.remove(),document.body.querySelector("#old-requests")?.remove(),document.body.querySelector("#feature-request-overlay + *").style.marginTop=`${m.clientHeight+b}px`)}})),a("i",{className:"far fa-trash-can fa-xl"},l)}t&&a("p",{id:"userId",title:"Click to copy",textContent:e.id.split("_")[0]},s).addEventListener("click",async()=>navigator.clipboard.writeText(e.id.split("_")[0])),(e.pending?u:d).append(r),i?.textContent&&(i.style.height=`${i.scrollHeight}px`)}var v;function O(e=v==="dark"?"light":"dark"){if(v!==e){v=e,localStorage.setItem("theme",v);for(let t of["bg","text","input-bg","input-focus-bg","card-bg","grey-text"])document.documentElement.style.setProperty(`--${t}-color`,`var(--${v}-mode-${t}-color)`);if(o.pageIsLoaded){let t=document.querySelectorAll("body, #header-container button, #header-container>#search-box, .card");for(let r of t)r.classList.add("color-transition");setTimeout(()=>{for(let r of t)r.classList.remove("color-transition")},R)}}}function H(e,t){return e.elements.namedItem(t)}var E,A=e=>{!e||e instanceof KeyboardEvent&&e.key!=="Escape"||T.style.display==="none"||(m.removeAttribute("inert"),d.removeAttribute("inert"),u.removeAttribute("inert"),E&&E.removeAttribute("inert"),o.smallScreen&&d.style.removeProperty("display"),T.style.removeProperty("display"))},U=L(async e=>{e.preventDefault();let t=e.target.parentElement;if(!t?.title||!t.description)return;let r=await f("vote/new",{method:"POST",body:JSON.stringify({title:H(t,"title").value.trim(),description:H(t,"description").value.trim()})}).catch(i=>i),n=await(r instanceof Response?r.json().catch(i=>i):r);if(n instanceof Error||"error"in n)return void Swal.fire({icon:"error",title:"Oops...",text:"error"in n?n.error:n.message});await Swal.fire({icon:"success",title:"Success",text:`Your feature request has been submitted and ${n.approved?"approved":"will be reviewed shortly"}.`}),o.cardsCache.set(n.id,n),n.approved&&(o.cardsOffset=0,p()),A(),t.reset()},g),$=L(async()=>{let e=[...document.body.querySelectorAll(".card[modified]")].reduce((n,i)=>{i.removeAttribute("modified");let s=o.cardsCache.get(i.id);return(s?.title&&i.children.title.textContent.trim()!==s.title||s?.body&&i.children.description?.textContent.trim()!==s.body)&&n.push({id:i.id,title:i.children.title.textContent.trim(),body:i.children.description?.textContent.trim()??""}),n},[]);if(!e.length)return void Swal.fire({icon:"error",title:"Oops...",text:"No cards have been modified."});let t=await f("vote/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).catch(n=>n),r=await(t instanceof Response?t.json().catch(n=>n):t);if(r instanceof Error||"error"in r)return void Swal.fire({icon:"error",title:"Oops...",text:"error"in r?r.error:r.message});Swal.fire({icon:"success",title:"Success",text:"The cards have been updated."}),o.cardsOffset=0,await w(),p()},g);async function F(){let e=document.createDocumentFragment(),t=a("div",{id:"profile-container"});if(o.user=await f("user").then(async s=>"json"in s?s.json():void 0).catch(()=>{}),!o.user||o.user.errorCode){if(o.user?.errorCode==q)return a("h2",{textContent:o.user.error},document.body,!0);e.append(y),a("button",{id:"feature-request-button",textContent:o.smallScreen?"New Request":"New Feature Request",className:"grey-hover"},e),a("button",{id:"login-button",textContent:o.smallScreen?"Login":"Login with Discord",className:"blue-button"},t).addEventListener("click",()=>globalThis.location.href=`/auth/discord?redirectUrl=${globalThis.location.href}`),e.append(t),m.append(e);return}let r=a("div",{id:"profile-container-wrapper"},t);t.addEventListener("click",s=>{r.contains(s.target)||(r.style.display=r.style.display==="flex"?"none":"flex")});let n=new Image(M,M);n.addEventListener("load",()=>t.append(n)),n.alt="Profile",n.src=`https://cdn.discordapp.com/avatars/${o.user.id}/${o.user.avatar}.webp?size=64`,a("div",{id:"username",textContent:o.user.displayName},r),a("button",{id:"logout-button",textContent:"Logout",className:"blue-button"},r).addEventListener("click",async()=>{let s=await fetch("/auth/logout");await Swal.fire(s.ok?{icon:"success",title:"Success",text:"You are now logged out."}:{icon:"error",title:"Logout failed",text:s.statusText}),s.ok&&globalThis.location.reload()});let i=a("button",{id:"feature-request-button",textContent:o.smallScreen?"New Request":"New Feature Request",className:"grey-hover"});o.smallScreen?(a("br",e),e.append(t),e.append(y),e.append(i)):(e.append(y),e.append(i),e.append(t)),m.append(e)}function j(){let e=T.querySelector("#feature-request-modal");e.querySelector("#feature-request-submit-button").addEventListener("click",U),m.querySelector("#feature-request-button").addEventListener("click",async()=>{if(!o.user?.id)return Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to create a feature request!"});m.inert=!0,d.inert=!0,u.inert=!0,E&&(E.inert=!0),T.style.display="block",o.smallScreen&&(d.style.display="none")}),e.querySelector("#feature-request-reset-btn").addEventListener("click",A),document.addEventListener("keydown",A);let t=e.querySelector("#feature-request-description");o.user?.dev&&t.removeAttribute("required");let r=e.querySelector("#title-counter"),n=e.querySelector("#description-counter");e.querySelector("#feature-request-title").addEventListener("input",i=>{r.textContent=`${i.target.value.length}/${x}`,r.classList.toggle("limit-reached",i.target.value.length>=x)}),t.addEventListener("input",i=>{n.textContent=`${i.target.value.length}/${S}`,n.classList.toggle("limit-reached",i.target.value.length>=S)})}async function G(e){if(o.cardsCache.has(e)){for(;!document.getElementById(e)&&o.cardsCache.size>o.cardsOffset;)p(),await new Promise(t=>void setTimeout(t,50));return document.getElementById(e)?.scrollIntoView({behavior:"smooth"})}}document.addEventListener("DOMContentLoaded",async()=>{O(localStorage.getItem("theme")??(globalThis.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark")),o.smallScreen=globalThis.matchMedia("(max-width: 768px)").matches;let e=o.smallScreen&&localStorage.getItem("displayMode")==="cardsInRows";await F(),j(),await w(),d.classList.add(e?h.rowMode:h.columnMode),u.classList.add(e?h.rowMode:h.columnMode),document.querySelector("#feature-request-count > span").textContent=o.cardsCache.size.toLocaleString(),globalThis.location.hash=="#new"&&m.querySelector("#feature-request-button").click(),navigator.clipboard??={writeText:t=>void Swal.fire({icon:"error",title:"Copying is not available due to this page being served over HTTP.",text:`This was what you tried to copy: ${t}`})},p(),setTimeout(async()=>G(globalThis.location.hash.slice(1)),g/10),o.user?.dev&&(u.childElementCount&&(document.body.insertBefore(a("h2",{id:"new-requests",textContent:"New Requests"}),u),document.body.insertBefore(a("h2",{id:"old-requests",textContent:"Approved Requests"}),d)),E=a("button",{id:"save-button",title:"Save",className:"blue-button"},document.body),a("i",{className:"fas fa-save fa-xl"},E),E.addEventListener("click",$)),document.body.querySelector("#feature-request-overlay + *").style.marginTop=`${m.clientHeight+b}px`,document.documentElement.style.scrollPaddingTop=`${m.clientHeight+20}px`,o.pageIsLoaded=!0});})();
//# sourceMappingURL=index.js.map
