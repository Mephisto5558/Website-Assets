function a(e,t,n,r=!1){let i=document.createElement(e);if(t)for(let s of Object.keys(t)){let m=t[s];m!==void 0&&(typeof m=="object"&&m!=null&&!Array.isArray(m)&&s in i?Object.assign(i[s],m):i[s]=m)}return n&&(r?n.replaceChildren(i):n.append(i)),i}var P="",D=403,B=200,x=140,M=4e3,H=39,b=16,C=768,_=300,g=1e3,f={columnMode:"cards-column-mode",rowMode:"cards-row-mode"},c=document.body.querySelector("#header-container"),d=document.body.querySelector("#cards-container"),u=document.body.querySelector("#cards-container-pending"),E=document.body.querySelector("#feature-request-overlay"),h=a("input",{type:"text",placeholder:"Search",id:"search-box",value:new URLSearchParams(globalThis.location.search).get("q")??"",className:"grey-hover",maxLength:B});var U={cardsCache:new Map,user:void 0,cardsOffset:0,pageIsLoaded:!1,smallScreen:!1},o=U;function T(e,t){let n;return async(...r)=>new Promise((i,s)=>{clearTimeout(n),n=setTimeout(()=>{try{i(e(...r))}catch(m){s(m instanceof Error?m:new Error(String(m)))}},t)})}var $=T(async(e,t)=>{if(!o.user?.id)return void Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to vote!"});let n=await y("vote/addvote",{method:"POST",body:JSON.stringify({featureId:e.id})}).then(async r=>r.json()).catch(r=>r instanceof Error?r:new Error(String(r)));if(n instanceof Error)return void Swal.fire({icon:"error",title:"Oops...",text:n.message});Swal.fire({icon:"success",title:"Success",text:"Your vote has been successfully recorded."}),e.votes=(e.votes??0)+1,t.textContent=e.votes.toLocaleString(),o.cardsOffset=0,p()},g);async function y(e,t={},n=5e3){t.body!=null&&!t.headers&&(t.headers={"Content-Type":"application/json"});let r=new AbortController;t.signal=r.signal;let i=setTimeout(()=>r.abort("Request timed out"),n);return await fetch(`${P}/api/v1/internal/${e}`,t).finally(()=>clearTimeout(i))}async function I(){let e=new Map((await y(`vote/list?includePending=${!!o.user?.dev}`).then(async t=>t.json())).cards?.toSorted((t,n)=>!t.pending&&n.pending?1:t.pending&&!n.pending?-1:(n.votes??0)-(t.votes??0)||t.title.localeCompare(n.title)).map(t=>[t.id,t]));o.cardsCache.clear();for(let[t,n]of e)o.cardsCache.set(t,n)}function G(e,t){let n=new URL(globalThis.location.href),r=new URLSearchParams(globalThis.location.search);t?r.set(e,t):r.delete(e),n.search=r.toString(),globalThis.history.pushState(void 0,"",n.toString())}function p(e=h.value,t=26){e=e.toLowerCase(),G("q",e);let n=e?[...o.cardsCache.values()].filter(r=>r.title.toLowerCase().includes(e)||r.body?.toLowerCase().includes(e)||r.id.toLowerCase().includes(e)):[...o.cardsCache.values()];if(!n.length&&!d.childElementCount&&!u.childElementCount)return void a("h2",{textContent:`There are currently no feature requests${e?" matching your search query":""} :(`},d,!0);o.cardsOffset||(d.innerHTML="",u.innerHTML="");for(let r of n.slice(o.cardsOffset,t+o.cardsOffset))F(r);return o.cardsOffset+=t,o.cardsCache.size>o.cardsOffset&&(d.childElementCount+u.childElementCount<t?p(e,t):d.clientHeight<window.innerHeight&&p(e,Math.ceil((window.innerHeight-d.clientHeight)/(d.clientHeight/d.childElementCount)))),n}function F(e){let t=!!o.user?.dev,n=a("div",{className:"card",id:e.id}),r=a("h2",{id:"title",textContent:e.title,contentEditable:t?"plaintext-only":"false"},n),i=e.body||t?a("p",{id:"description",textContent:e.body??"",contentEditable:t?"plaintext-only":"false"},n):void 0,s=a("div",{className:"vote-buttons"},n),m=a("span",{className:"vote-counter",textContent:e.pending?"":(e.votes??0).toString()});e.pending&&t?a("button",{textContent:"Approve",className:"vote-button blue-button"},s).addEventListener("click",async()=>{let l=await y("vote/approve",{method:"POST",body:JSON.stringify({featureId:e.id})}).then(async v=>v.json()).catch(v=>v instanceof Error?v:new Error(String(v)));if(l instanceof Error)return void Swal.fire({icon:"error",title:"Oops...",text:l.message});Swal.fire({icon:"success",title:"Success",text:"The feature request has been approved."}),d.append(n),u.childElementCount||(document.body.querySelector("#new-requests")?.remove(),document.body.querySelector("#old-requests")?.remove(),E.nextElementSibling.style.marginTop=`${c.clientHeight+b}px`)}):e.pending||a("button",{className:"vote-button blue-button",textContent:"Upvote"},s).addEventListener("click",async()=>$(e,m)),s.append(m);let q=a("button",{title:"Copy card Id",className:"manage-button grey-hover"},s),O=a("i",{className:"far fa-copy fa-xl"},q);if(q.addEventListener("click",()=>{navigator.clipboard.writeText(e.id),O.classList="fas fa-check fa-xl",setTimeout(()=>O.classList="far fa-copy fa-xl",g*3)}),t&&(r.addEventListener("keydown",l=>{!(l.target instanceof HTMLElement)||!(l.target.parentElement instanceof HTMLElement)||(l.target.parentElement.hasAttribute("modified")?l.target.textContent==e.title&&l.target.parentElement.removeAttribute("modified"):l.target.textContent!=e.title&&l.target.parentElement.setAttribute("modified",""),l.key==="Enter"&&(l.preventDefault(),l.target.nextElementSibling.firstElementChild.focus()))}),i?.addEventListener("input",l=>{!(l.target instanceof HTMLElement)||!(l.target.parentElement instanceof HTMLElement)||(l.target.parentElement.hasAttribute("modified")?l.target.textContent==e.body&&l.target.parentElement.removeAttribute("modified"):l.target.textContent!=e.body&&l.target.parentElement.setAttribute("modified",""))})),t||o.user?.id==e.id.split("_")[0]){let l=a("button",{title:"Delete card",className:"manage-button grey-hover"},s);l.addEventListener("click",async()=>Swal.fire({icon:"warning",title:"Are you sure?",text:"Are you sure you want to delete that card? This action cannot be undone!",showCancelButton:!0,preConfirm:async()=>{await y("vote/delete",{method:"DELETE",body:JSON.stringify({featureId:e.id})}),n.remove(),u.childElementCount||(document.body.querySelector("#new-requests")?.remove(),document.body.querySelector("#old-requests")?.remove(),E.nextElementSibling.style.marginTop=`${c.clientHeight+b}px`)}})),a("i",{className:"far fa-trash-can fa-xl"},l)}t&&a("p",{id:"userId",title:"Click to copy",textContent:e.id.split("_")[0]},s).addEventListener("click",async()=>navigator.clipboard.writeText(e.id.split("_")[0])),(e.pending?u:d).append(n),i?.textContent&&(i.style.height=`${i.scrollHeight}px`)}function k(){localStorage.setItem("displayMode",d.classList.contains(f.columnMode)?"cardsInRows":"cardsInColumns"),d.classList.toggle(f.columnMode),u.classList.toggle(f.columnMode),d.classList.toggle(f.rowMode),u.classList.toggle(f.rowMode)}var S;function w(e=S==="dark"?"light":"dark"){if(S!==e){S=e,localStorage.setItem("theme",S);for(let t of["bg","text","input-bg","input-focus-bg","card-bg","grey-text"])document.documentElement.style.setProperty(`--${t}-color`,`var(--${S}-mode-${t}-color)`);if(o.pageIsLoaded){let t=document.querySelectorAll("body, #header-container button, #header-container>#search-box, .card");for(let n of t)n.classList.add("color-transition");setTimeout(()=>{for(let n of t)n.classList.remove("color-transition")},_)}}}function A(e,t){return e.elements.namedItem(t)}h.addEventListener("input",T(e=>{if(!(e.target instanceof HTMLInputElement))return;e.target.value.length>e.target.maxLength&&(e.target.value=e.target.value.slice(0,e.target.maxLength)),o.cardsOffset=0;let t=p(e.target.value);document.querySelector("#feature-request-count > span").textContent=(t?.length??0).toLocaleString()},g/2));c.querySelector("#toggle-cards-display").addEventListener("click",()=>k());c.querySelector("#toggle-color-scheme").addEventListener("click",()=>w());window.addEventListener("scroll",()=>{o.cardsCache.size>o.cardsOffset&&document.documentElement.scrollTop+document.documentElement.clientHeight>=document.documentElement.scrollHeight-b&&p()});var N=window.innerWidth;window.addEventListener("resize",T(()=>{let e=window.innerWidth;N>=C&&e<C||N<C&&e>=C?globalThis.location.reload():N=e},g/2));window.addEventListener("beforeunload",e=>{document.body.querySelectorAll(".card[modified]").length&&e.preventDefault()});var L,R=e=>{!e||e instanceof KeyboardEvent&&e.key!=="Escape"||E.style.display==="none"||(c.removeAttribute("inert"),d.removeAttribute("inert"),u.removeAttribute("inert"),L&&L.removeAttribute("inert"),o.smallScreen&&d.style.removeProperty("display"),E.style.removeProperty("display"))},W=T(async e=>{if(e.preventDefault(),!(e.target instanceof HTMLButtonElement&&e.target.parentElement instanceof HTMLFormElement))return;let t=e.target.parentElement;if(!t.elements.namedItem("title")||!t.elements.namedItem("description"))return;let n=await y("vote/new",{method:"POST",body:JSON.stringify({title:A(t,"title").value.trim(),description:A(t,"description").value.trim()})}).catch(i=>i instanceof Error?i:new Error(String(i))),r=await(n instanceof Response?n.json().catch(i=>i):n);if(r instanceof Error||"error"in r)return void Swal.fire({icon:"error",title:"Oops...",text:"error"in r?r.error:r.message});await Swal.fire({icon:"success",title:"Success",text:`Your feature request has been submitted and ${r.approved?"approved":"will be reviewed shortly"}.`}),o.cardsCache.set(r.id,r),r.approved&&(o.cardsOffset=0,p()),R(),t.reset()},g),j=T(async()=>{let e=[...document.body.querySelectorAll(".card[modified]")].reduce((r,i)=>{i.removeAttribute("modified");let s=o.cardsCache.get(i.id);return(s?.title&&i.children.title.textContent.trim()!==s.title||s?.body&&i.children.description?.textContent.trim()!==s.body)&&r.push({id:i.id,title:i.children.title.textContent.trim(),body:i.children.description?.textContent.trim()??""}),r},[]);if(!e.length)return void Swal.fire({icon:"error",title:"Oops...",text:"No cards have been modified."});let t=await y("vote/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).catch(r=>r instanceof Error?r:new Error(String(r))),n=await(t instanceof Response?t.json().catch(r=>r):t);if(n instanceof Error||"error"in n)return void Swal.fire({icon:"error",title:"Oops...",text:"error"in n?n.error:n.message});Swal.fire({icon:"success",title:"Success",text:"The cards have been updated."}),o.cardsOffset=0,await I(),p()},g);async function Y(){let e=document.createDocumentFragment(),t=a("div",{id:"profile-container"});if(o.user=await y("user").then(async s=>"json"in s?s.json():void 0).catch(()=>{}),!o.user||o.user.errorCode){if(o.user?.errorCode==D)return a("h2",{textContent:o.user.error},document.body,!0);e.append(h),a("button",{id:"feature-request-button",textContent:o.smallScreen?"New Request":"New Feature Request",className:"grey-hover"},e),a("button",{id:"login-button",textContent:o.smallScreen?"Login":"Login with Discord",className:"blue-button"},t).addEventListener("click",()=>globalThis.location.href=`/auth/discord?redirectUrl=${globalThis.location.href}`),e.append(t),c.append(e);return}let n=a("div",{id:"profile-container-wrapper"},t);t.addEventListener("click",s=>{n.contains(s.target)||(n.style.display=n.style.display==="flex"?"none":"flex")});let r=new Image(H,H);r.addEventListener("load",()=>t.append(r)),r.alt="Profile",r.src=`https://cdn.discordapp.com/avatars/${o.user.id}/${o.user.avatar}.webp?size=64`,a("div",{id:"username",textContent:o.user.displayName},n),a("button",{id:"logout-button",textContent:"Logout",className:"blue-button"},n).addEventListener("click",async()=>{let s=await fetch("/auth/logout");await Swal.fire(s.ok?{icon:"success",title:"Success",text:"You are now logged out."}:{icon:"error",title:"Logout failed",text:s.statusText}),s.ok&&globalThis.location.reload()});let i=a("button",{id:"feature-request-button",textContent:o.smallScreen?"New Request":"New Feature Request",className:"grey-hover"});o.smallScreen?(a("br",e),e.append(t),e.append(h),e.append(i)):(e.append(h),e.append(i),e.append(t)),c.append(e)}function z(){let e=E.querySelector("#feature-request-modal");e.querySelector("#feature-request-submit-button").addEventListener("click",W),c.querySelector("#feature-request-button").addEventListener("click",async()=>{if(!o.user?.id)return Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to create a feature request!"});c.inert=!0,d.inert=!0,u.inert=!0,L&&(L.inert=!0),E.style.display="block",o.smallScreen&&(d.style.display="none")}),e.querySelector("#feature-request-reset-btn").addEventListener("click",R),document.addEventListener("keydown",R);let t=e.querySelector("#feature-request-description");o.user?.dev&&t.removeAttribute("required");let n=e.querySelector("#title-counter"),r=e.querySelector("#description-counter");e.querySelector("#feature-request-title").addEventListener("input",i=>{i.target instanceof HTMLInputElement&&(n.textContent=`${i.target.value.length}/${x}`,n.classList.toggle("limit-reached",i.target.value.length>=x))}),t.addEventListener("input",i=>{i.target instanceof HTMLTextAreaElement&&(r.textContent=`${i.target.value.length}/${M}`,r.classList.toggle("limit-reached",i.target.value.length>=M))})}async function X(e){if(o.cardsCache.has(e)){for(;!document.getElementById(e)&&o.cardsCache.size>o.cardsOffset;)p(),await new Promise(t=>void setTimeout(t,50));return document.getElementById(e)?.scrollIntoView({behavior:"smooth"})}}document.addEventListener("DOMContentLoaded",async()=>{w(localStorage.getItem("theme")??(globalThis.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark")),o.smallScreen=globalThis.matchMedia("(max-width: 768px)").matches;let e=o.smallScreen&&localStorage.getItem("displayMode")==="cardsInRows";await Y(),z(),await I(),d.classList.add(e?f.rowMode:f.columnMode),u.classList.add(e?f.rowMode:f.columnMode),document.querySelector("#feature-request-count > span").textContent=o.cardsCache.size.toLocaleString(),globalThis.location.hash=="#new"&&c.querySelector("#feature-request-button").click(),navigator.clipboard??={writeText:t=>void Swal.fire({icon:"error",title:"Copying is not available due to this page being served over HTTP.",text:`This was what you tried to copy: ${t}`})},p(),setTimeout(async()=>X(globalThis.location.hash.slice(1)),g/10),o.user?.dev&&(u.childElementCount&&(document.body.insertBefore(a("h2",{id:"new-requests",textContent:"New Requests"}),u),document.body.insertBefore(a("h2",{id:"old-requests",textContent:"Approved Requests"}),d)),L=a("button",{id:"save-button",title:"Save",className:"blue-button"},document.body),a("i",{className:"fas fa-save fa-xl"},L),L.addEventListener("click",j)),E.nextElementSibling.style.marginTop=`${c.clientHeight+b}px`,document.documentElement.style.scrollPaddingTop=`${c.clientHeight+20}px`,o.pageIsLoaded=!0});
//# sourceMappingURL=index.js.map
