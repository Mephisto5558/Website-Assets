"use strict";(()=>{function s(e,t,n,i=!1){let a=document.createElement(e);if(t)for(let c of Object.keys(t)){let l=t[c];l!==void 0&&(typeof l=="object"&&l!=null&&!Array.isArray(l)&&c in a?Object.assign(a[c],l):a[c]=l)}return n&&(i?n.replaceChildren(a):n.append(a)),a}var L=200;var h=16;var v=300,g=1e3,f={columnMode:"cards-column-mode",rowMode:"cards-row-mode"},y=document.body.querySelector("#header-container"),d=document.body.querySelector("#cards-container"),u=document.body.querySelector("#cards-container-pending"),O=document.body.querySelector("#feature-request-overlay"),x=s("input",{type:"text",placeholder:"Search",id:"search-box",value:new URLSearchParams(globalThis.location.search).get("q")??"",className:"grey-hover",maxLength:L});var r=class{static cardsCache=new Map;static user;static cardsOffset=0;static pageIsLoaded=!1;static smallScreen=!1};function M(e,t){let n;return(...i)=>new Promise((a,c)=>{clearTimeout(n),n=setTimeout(()=>{try{a(e(...i))}catch(l){c(l instanceof Error?l:new Error(l))}},t)})}var S=M(async(e,t)=>{if(!r.user?.id)return void Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to vote!"});let n=await p("vote/addvote",{method:"POST",body:JSON.stringify({featureId:e})});try{n=await n.json()}catch{}if(n.ok===!1||n.error)return void Swal.fire({icon:"error",title:"Oops...",text:n.error??n.statusText});Swal.fire({icon:"success",title:"Success",text:"Your vote has been successfully recorded."}),t.textContent=Number.parseInt(t.textContent)+1,r.cardsOffset=0,b()},g);async function p(e,t={},n=5e3){t.body!=null&&!t.headers&&(t.headers={"Content-Type":"application/json"}),t.signal??=new AbortController().signal;let i=setTimeout(()=>t.signal.abort("Request timed out"),n),a=await fetch(e?`/api/v1/internal/${e}`:void 0,t);return clearTimeout(i),a}async function D(){let e=new Map((await p(`vote/list?includePending=${!!r.user?.dev}`).then(t=>t.json()))?.cards?.sort((t,n)=>!t.pending&&n.pending?1:t.pending&&!n.pending?-1:(n.votes??0)-(t.votes??0)||t.title.localeCompare(n.title)).map(t=>[t.id,t]));r.cardsCache.clear();for(let[t,n]of e)r.cardsCache.set(t,n)}function w(e,t){let n=new URL(globalThis.location.href),i=new URLSearchParams(globalThis.location.search);t?i.set(e,t):i.delete(e),n.search=i.toString(),globalThis.history.pushState(void 0,"",n.toString())}function b(e=x.value,t=26){e=e.toLowerCase(),w("q",e);let n=e?[...r.cardsCache.values()].filter(i=>i.title.toLowerCase().includes(e)||i.body?.toLowerCase().includes(e)||i.id.toLowerCase().includes(e)):[...r.cardsCache.values()];if(!n.length&&!d.childElementCount&&!u.childElementCount)return void s("h2",{textContent:`There are currently no feature requests${e?" matching your search query":""} :(`},d,!0);r.cardsOffset||(d.innerHTML="",u.innerHTML="");for(let i of n.slice(r.cardsOffset,t+r.cardsOffset))A(i);return r.cardsOffset+=t,r.cardsCache.size>r.cardsOffset&&(d.childElementCount+u.childElementCount<t?b(e,t):d.clientHeight<window.innerHeight&&b(e,Math.ceil((window.innerHeight-d.clientHeight)/(d.clientHeight/d.childElementCount)))),n}function A(e){let t=!!r.user?.dev,n=s("div",{className:"card",id:e.id}),i=s("h2",{id:"title",textContent:e.title,contentEditable:t?"plaintext-only":"false"},n),a=e.body||t?s("p",{id:"description",textContent:e.body??"",contentEditable:t?"plaintext-only":"false"},n):void 0,c=s("div",{className:"vote-buttons"},n),l=s("span",{className:"vote-counter",textContent:e.pending?"":(e.votes??0).toString()});e.pending&&t?s("button",{textContent:"Approve",className:"vote-button blue-button"},c).addEventListener("click",async()=>{let o=await p("vote/approve",{method:"POST",body:JSON.stringify({featureId:e.id})}).then(E=>E.json()).catch(E=>E);if(o.ok===!1||o.error)return void Swal.fire({icon:"error",title:"Oops...",text:o.error??o.statusText});Swal.fire({icon:"success",title:"Success",text:"The feature request has been approved."}),d.append(n),u.childElementCount||(document.body.querySelector("#new-requests")?.remove(),document.body.querySelector("#old-requests")?.remove(),document.body.querySelector("#feature-request-overlay + *").style.marginTop=`${y.clientHeight+h}px`)}):e.pending||s("button",{className:"vote-button blue-button",textContent:"Upvote"},c).addEventListener("click",()=>S(e.id,l)),c.append(l);let T=s("button",{title:"Copy card Id",className:"manage-button grey-hover"},c),C=s("i",{className:"far fa-copy fa-xl"},T);if(T.addEventListener("click",()=>{navigator.clipboard.writeText(e.id),C.classList="fas fa-check fa-xl",setTimeout(()=>C.classList="far fa-copy fa-xl",g*3)}),t&&(i.addEventListener("keydown",o=>{!(o.target instanceof HTMLElement)||!(o.target?.parentElement instanceof HTMLElement)||(o.target.parentElement.hasAttribute("modified")?o.target.textContent==e.title&&o.target.parentElement.removeAttribute("modified"):o.target.textContent!=e.title&&o.target.parentElement.setAttribute("modified",""),o.key==="Enter"&&(o.preventDefault(),o.target.nextElementSibling.firstChild.focus()))}),a?.addEventListener("input",({target:o})=>{o.parentElement.hasAttribute("modified")?o.textContent==e.body&&o.parentElement.removeAttribute("modified"):o.textContent!=e.body&&o.parentElement.setAttribute("modified","")})),t||r.user?.id==e.id.split("_")[0]){let o=s("button",{title:"Delete card",className:"manage-button grey-hover"},c);o.addEventListener("click",()=>Swal.fire({icon:"warning",title:"Are you sure?",text:"Are you sure you want to delete that card? This action cannot be undone!",showCancelButton:!0,preConfirm:async()=>{await p("vote/delete",{method:"DELETE",body:JSON.stringify({featureId:e.id})}),n.remove(),u.childElementCount||(document.body.querySelector("#new-requests")?.remove(),document.body.querySelector("#old-requests")?.remove(),document.body.querySelector("#feature-request-overlay + *").style.marginTop=`${y.clientHeight+h}px`)}})),s("i",{className:"far fa-trash-can fa-xl"},o)}t&&s("p",{id:"userId",title:"Click to copy",textContent:e.id.split("_")[0]},c).addEventListener("click",()=>navigator.clipboard.writeText(e.id.split("_")[0])),(e.pending?u:d).append(n),a?.value&&(a.style.height=`${a.scrollHeight}px`)}function q(){localStorage.setItem("displayMode",d.classList.contains(f.columnMode)?"cardsInRows":"cardsInColumns"),d.classList.toggle(f.columnMode),u.classList.toggle(f.columnMode),d.classList.toggle(f.rowMode),u.classList.toggle(f.rowMode)}var m;function B(e=m==="dark"?"light":"dark"){if(m!==e){m=e,localStorage.setItem("theme",m);for(let t of["bg","text","input-bg","input-focus-bg","card-bg","grey-text"])document.documentElement.style.setProperty(`--${t}-color`,`var(--${m}-mode-${t}-color)`);if(r.pageIsLoaded){let t=document.querySelectorAll("body, #header-container button, #header-container>#search-box, .card");for(let n of t)n.classList.add("color-transition");setTimeout(()=>{for(let n of t)n.classList.remove("color-transition")},v)}}}})();
//# sourceMappingURL=utils.js.map
