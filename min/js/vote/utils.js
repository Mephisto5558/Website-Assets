"use strict";(()=>{function a(e,t,n,r=!1){let s=document.createElement(e);if(t)for(let d of Object.keys(t)){let c=t[d];c!==void 0&&(typeof c=="object"&&c!=null&&!Array.isArray(c)&&d in s?Object.assign(s[d],c):s[d]=c)}return n&&(r?n.replaceChildren(s):n.append(s)),s}var v=200;var g=16;var L=300,h=1e3,f={columnMode:"cards-column-mode",rowMode:"cards-row-mode"},y=document.body.querySelector("#header-container"),l=document.body.querySelector("#cards-container"),u=document.body.querySelector("#cards-container-pending"),O=document.body.querySelector("#feature-request-overlay"),x=a("input",{type:"text",placeholder:"Search",id:"search-box",value:new URLSearchParams(globalThis.location.search).get("q")??"",className:"grey-hover",maxLength:v});var M={cardsCache:new Map,user:void 0,cardsOffset:0,pageIsLoaded:!1,smallScreen:!1},i=M;function S(e,t){let n;return async(...r)=>new Promise((s,d)=>{clearTimeout(n),n=setTimeout(()=>{try{s(e(...r))}catch(c){d(c instanceof Error?c:new Error(c))}},t)})}var w=S(async(e,t)=>{if(!i.user?.id)return void Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to vote!"});let n=await p("vote/addvote",{method:"POST",body:JSON.stringify({featureId:e})});try{n=await n.json()}catch{}if(n.ok===!1||n.error)return void Swal.fire({icon:"error",title:"Oops...",text:n.error??n.statusText});Swal.fire({icon:"success",title:"Success",text:"Your vote has been successfully recorded."});let r=i.cardsCache.get(e);r.votes=(r.votes??0)+1,t.textContent=r.votes.toLocaleString(),i.cardsOffset=0,T()},h);async function p(e,t={},n=5e3){t.body!=null&&!t.headers&&(t.headers={"Content-Type":"application/json"});let r=new AbortController;t.signal=r.signal;let s=setTimeout(()=>r.abort("Request timed out"),n);return await fetch(`/api/v1/internal/${e}`,t).finally(()=>clearTimeout(s))}async function q(){let e=new Map((await p(`vote/list?includePending=${!!i.user?.dev}`).then(t=>t.json()))?.cards?.toSorted((t,n)=>!t.pending&&n.pending?1:t.pending&&!n.pending?-1:(n.votes??0)-(t.votes??0)||t.title.localeCompare(n.title)).map(t=>[t.id,t]));i.cardsCache.clear();for(let[t,n]of e)i.cardsCache.set(t,n)}function A(e,t){let n=new URL(globalThis.location.href),r=new URLSearchParams(globalThis.location.search);t?r.set(e,t):r.delete(e),n.search=r.toString(),globalThis.history.pushState(void 0,"",n.toString())}function T(e=x.value,t=26){e=e.toLowerCase(),A("q",e);let n=e?[...i.cardsCache.values()].filter(r=>r.title.toLowerCase().includes(e)||r.body?.toLowerCase().includes(e)||r.id.toLowerCase().includes(e)):[...i.cardsCache.values()];if(!n.length&&!l.childElementCount&&!u.childElementCount)return void a("h2",{textContent:`There are currently no feature requests${e?" matching your search query":""} :(`},l,!0);i.cardsOffset||(l.innerHTML="",u.innerHTML="");for(let r of n.slice(i.cardsOffset,t+i.cardsOffset))H(r);return i.cardsOffset+=t,i.cardsCache.size>i.cardsOffset&&(l.childElementCount+u.childElementCount<t?T(e,t):l.clientHeight<window.innerHeight&&T(e,Math.ceil((window.innerHeight-l.clientHeight)/(l.clientHeight/l.childElementCount)))),n}function H(e){let t=!!i.user?.dev,n=a("div",{className:"card",id:e.id}),r=a("h2",{id:"title",textContent:e.title,contentEditable:t?"plaintext-only":"false"},n),s=e.body||t?a("p",{id:"description",textContent:e.body??"",contentEditable:t?"plaintext-only":"false"},n):void 0,d=a("div",{className:"vote-buttons"},n),c=a("span",{className:"vote-counter",textContent:e.pending?"":(e.votes??0).toString()});e.pending&&t?a("button",{textContent:"Approve",className:"vote-button blue-button"},d).addEventListener("click",async()=>{let o=await p("vote/approve",{method:"POST",body:JSON.stringify({featureId:e.id})}).then(E=>E.json()).catch(E=>E);if(o.ok===!1||o.error)return void Swal.fire({icon:"error",title:"Oops...",text:o.error??o.statusText});Swal.fire({icon:"success",title:"Success",text:"The feature request has been approved."}),l.append(n),u.childElementCount||(document.body.querySelector("#new-requests")?.remove(),document.body.querySelector("#old-requests")?.remove(),document.body.querySelector("#feature-request-overlay + *").style.marginTop=`${y.clientHeight+g}px`)}):e.pending||a("button",{className:"vote-button blue-button",textContent:"Upvote"},d).addEventListener("click",async()=>w(e.id,c)),d.append(c);let b=a("button",{title:"Copy card Id",className:"manage-button grey-hover"},d),C=a("i",{className:"far fa-copy fa-xl"},b);if(b.addEventListener("click",()=>{navigator.clipboard.writeText(e.id),C.classList="fas fa-check fa-xl",setTimeout(()=>C.classList="far fa-copy fa-xl",h*3)}),t&&(r.addEventListener("keydown",o=>{!(o.target instanceof HTMLElement)||!(o.target.parentElement instanceof HTMLElement)||(o.target.parentElement.hasAttribute("modified")?o.target.textContent==e.title&&o.target.parentElement.removeAttribute("modified"):o.target.textContent!=e.title&&o.target.parentElement.setAttribute("modified",""),o.key==="Enter"&&(o.preventDefault(),o.target.nextElementSibling.firstElementChild.focus()))}),s?.addEventListener("input",o=>{!(o.target instanceof HTMLElement)||!(o.target.parentElement instanceof HTMLElement)||(o.target.parentElement.hasAttribute("modified")?o.target.textContent==e.body&&o.target.parentElement.removeAttribute("modified"):o.target.textContent!=e.body&&o.target.parentElement.setAttribute("modified",""))})),t||i.user?.id==e.id.split("_")[0]){let o=a("button",{title:"Delete card",className:"manage-button grey-hover"},d);o.addEventListener("click",async()=>Swal.fire({icon:"warning",title:"Are you sure?",text:"Are you sure you want to delete that card? This action cannot be undone!",showCancelButton:!0,preConfirm:async()=>{await p("vote/delete",{method:"DELETE",body:JSON.stringify({featureId:e.id})}),n.remove(),u.childElementCount||(document.body.querySelector("#new-requests")?.remove(),document.body.querySelector("#old-requests")?.remove(),document.body.querySelector("#feature-request-overlay + *").style.marginTop=`${y.clientHeight+g}px`)}})),a("i",{className:"far fa-trash-can fa-xl"},o)}t&&a("p",{id:"userId",title:"Click to copy",textContent:e.id.split("_")[0]},d).addEventListener("click",async()=>navigator.clipboard.writeText(e.id.split("_")[0])),(e.pending?u:l).append(n),s?.textContent&&(s.style.height=`${s.scrollHeight}px`)}function B(){localStorage.setItem("displayMode",l.classList.contains(f.columnMode)?"cardsInRows":"cardsInColumns"),l.classList.toggle(f.columnMode),u.classList.toggle(f.columnMode),l.classList.toggle(f.rowMode),u.classList.toggle(f.rowMode)}var m;function G(e=m==="dark"?"light":"dark"){if(m!==e){m=e,localStorage.setItem("theme",m);for(let t of["bg","text","input-bg","input-focus-bg","card-bg","grey-text"])document.documentElement.style.setProperty(`--${t}-color`,`var(--${m}-mode-${t}-color)`);if(i.pageIsLoaded){let t=document.querySelectorAll("body, #header-container button, #header-container>#search-box, .card");for(let n of t)n.classList.add("color-transition");setTimeout(()=>{for(let n of t)n.classList.remove("color-transition")},L)}}}function $(e,t){return e.elements.namedItem(t)}})();
//# sourceMappingURL=utils.js.map
