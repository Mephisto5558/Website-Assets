"use strict";(()=>{function a(e,t,n,r=!1){let s=document.createElement(e);if(t)for(let d of Object.keys(t)){let c=t[d];c!==void 0&&(typeof c=="object"&&c!=null&&!Array.isArray(c)&&d in s?Object.assign(s[d],c):s[d]=c)}return n&&(r?n.replaceChildren(s):n.append(s)),s}var H=200;var E=16,h=768,S=300,m=1e3,f={columnMode:"cards-column-mode",rowMode:"cards-row-mode"},g=document.body.querySelector("#header-container"),l=document.body.querySelector("#cards-container"),u=document.body.querySelector("#cards-container-pending"),k=document.body.querySelector("#feature-request-overlay"),T=a("input",{type:"text",placeholder:"Search",id:"search-box",value:new URLSearchParams(globalThis.location.search).get("q")??"",className:"grey-hover",maxLength:H});var I={cardsCache:new Map,user:void 0,cardsOffset:0,pageIsLoaded:!1,smallScreen:!1},i=I;function L(e,t){let n;return async(...r)=>new Promise((s,d)=>{clearTimeout(n),n=setTimeout(()=>{try{s(e(...r))}catch(c){d(c instanceof Error?c:new Error(String(c)))}},t)})}var N=L(async(e,t)=>{if(!i.user?.id)return void Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to vote!"});let n=await b("vote/addvote",{method:"POST",body:JSON.stringify({featureId:e})});try{n=await n.json()}catch{}if(n.ok===!1||n.error)return void Swal.fire({icon:"error",title:"Oops...",text:n.error??n.statusText});Swal.fire({icon:"success",title:"Success",text:"Your vote has been successfully recorded."});let r=i.cardsCache.get(e);r.votes=(r.votes??0)+1,t.textContent=r.votes.toLocaleString(),i.cardsOffset=0,p()},m);async function b(e,t={},n=5e3){t.body!=null&&!t.headers&&(t.headers={"Content-Type":"application/json"});let r=new AbortController;t.signal=r.signal;let s=setTimeout(()=>r.abort("Request timed out"),n);return await fetch(`/api/v1/internal/${e}`,t).finally(()=>clearTimeout(s))}function O(e,t){let n=new URL(globalThis.location.href),r=new URLSearchParams(globalThis.location.search);t?r.set(e,t):r.delete(e),n.search=r.toString(),globalThis.history.pushState(void 0,"",n.toString())}function p(e=T.value,t=26){e=e.toLowerCase(),O("q",e);let n=e?[...i.cardsCache.values()].filter(r=>r.title.toLowerCase().includes(e)||r.body?.toLowerCase().includes(e)||r.id.toLowerCase().includes(e)):[...i.cardsCache.values()];if(!n.length&&!l.childElementCount&&!u.childElementCount)return void a("h2",{textContent:`There are currently no feature requests${e?" matching your search query":""} :(`},l,!0);i.cardsOffset||(l.innerHTML="",u.innerHTML="");for(let r of n.slice(i.cardsOffset,t+i.cardsOffset))R(r);return i.cardsOffset+=t,i.cardsCache.size>i.cardsOffset&&(l.childElementCount+u.childElementCount<t?p(e,t):l.clientHeight<window.innerHeight&&p(e,Math.ceil((window.innerHeight-l.clientHeight)/(l.clientHeight/l.childElementCount)))),n}function R(e){let t=!!i.user?.dev,n=a("div",{className:"card",id:e.id}),r=a("h2",{id:"title",textContent:e.title,contentEditable:t?"plaintext-only":"false"},n),s=e.body||t?a("p",{id:"description",textContent:e.body??"",contentEditable:t?"plaintext-only":"false"},n):void 0,d=a("div",{className:"vote-buttons"},n),c=a("span",{className:"vote-counter",textContent:e.pending?"":(e.votes??0).toString()});e.pending&&t?a("button",{textContent:"Approve",className:"vote-button blue-button"},d).addEventListener("click",async()=>{let o=await b("vote/approve",{method:"POST",body:JSON.stringify({featureId:e.id})}).then(C=>C.json()).catch(C=>C);if(o.ok===!1||o.error)return void Swal.fire({icon:"error",title:"Oops...",text:o.error??o.statusText});Swal.fire({icon:"success",title:"Success",text:"The feature request has been approved."}),l.append(n),u.childElementCount||(document.body.querySelector("#new-requests")?.remove(),document.body.querySelector("#old-requests")?.remove(),document.body.querySelector("#feature-request-overlay + *").style.marginTop=`${g.clientHeight+E}px`)}):e.pending||a("button",{className:"vote-button blue-button",textContent:"Upvote"},d).addEventListener("click",async()=>N(e.id,c)),d.append(c);let v=a("button",{title:"Copy card Id",className:"manage-button grey-hover"},d),M=a("i",{className:"far fa-copy fa-xl"},v);if(v.addEventListener("click",()=>{navigator.clipboard.writeText(e.id),M.classList="fas fa-check fa-xl",setTimeout(()=>M.classList="far fa-copy fa-xl",m*3)}),t&&(r.addEventListener("keydown",o=>{!(o.target instanceof HTMLElement)||!(o.target.parentElement instanceof HTMLElement)||(o.target.parentElement.hasAttribute("modified")?o.target.textContent==e.title&&o.target.parentElement.removeAttribute("modified"):o.target.textContent!=e.title&&o.target.parentElement.setAttribute("modified",""),o.key==="Enter"&&(o.preventDefault(),o.target.nextElementSibling.firstElementChild.focus()))}),s?.addEventListener("input",o=>{!(o.target instanceof HTMLElement)||!(o.target.parentElement instanceof HTMLElement)||(o.target.parentElement.hasAttribute("modified")?o.target.textContent==e.body&&o.target.parentElement.removeAttribute("modified"):o.target.textContent!=e.body&&o.target.parentElement.setAttribute("modified",""))})),t||i.user?.id==e.id.split("_")[0]){let o=a("button",{title:"Delete card",className:"manage-button grey-hover"},d);o.addEventListener("click",async()=>Swal.fire({icon:"warning",title:"Are you sure?",text:"Are you sure you want to delete that card? This action cannot be undone!",showCancelButton:!0,preConfirm:async()=>{await b("vote/delete",{method:"DELETE",body:JSON.stringify({featureId:e.id})}),n.remove(),u.childElementCount||(document.body.querySelector("#new-requests")?.remove(),document.body.querySelector("#old-requests")?.remove(),document.body.querySelector("#feature-request-overlay + *").style.marginTop=`${g.clientHeight+E}px`)}})),a("i",{className:"far fa-trash-can fa-xl"},o)}t&&a("p",{id:"userId",title:"Click to copy",textContent:e.id.split("_")[0]},d).addEventListener("click",async()=>navigator.clipboard.writeText(e.id.split("_")[0])),(e.pending?u:l).append(n),s?.textContent&&(s.style.height=`${s.scrollHeight}px`)}function w(){localStorage.setItem("displayMode",l.classList.contains(f.columnMode)?"cardsInRows":"cardsInColumns"),l.classList.toggle(f.columnMode),u.classList.toggle(f.columnMode),l.classList.toggle(f.rowMode),u.classList.toggle(f.rowMode)}var y;function A(e=y==="dark"?"light":"dark"){if(y!==e){y=e,localStorage.setItem("theme",y);for(let t of["bg","text","input-bg","input-focus-bg","card-bg","grey-text"])document.documentElement.style.setProperty(`--${t}-color`,`var(--${y}-mode-${t}-color)`);if(i.pageIsLoaded){let t=document.querySelectorAll("body, #header-container button, #header-container>#search-box, .card");for(let n of t)n.classList.add("color-transition");setTimeout(()=>{for(let n of t)n.classList.remove("color-transition")},S)}}}var X=void 0;T.addEventListener("input",L(e=>{if(!(e.target instanceof HTMLInputElement))return;e.target.value.length>e.target.maxLength&&(e.target.value=e.target.value.slice(0,e.target.maxLength)),i.cardsOffset=0;let t=p(e.target.value);document.querySelector("#feature-request-count > span").textContent=(t?.length??0).toLocaleString()},m/2));g.querySelector("#toggle-cards-display").addEventListener("click",()=>w());g.querySelector("#toggle-color-scheme").addEventListener("click",()=>A());window.addEventListener("scroll",()=>{i.cardsCache.size>i.cardsOffset&&document.documentElement.scrollTop+document.documentElement.clientHeight>=document.documentElement.scrollHeight-E&&p()});var x=window.innerWidth;window.addEventListener("resize",L(()=>{let e=window.innerWidth;x>=h&&e<h||x<h&&e>=h?globalThis.location.reload():x=e},m/2));window.addEventListener("beforeunload",e=>{document.body.querySelectorAll(".card[modified]").length&&e.preventDefault()});})();
//# sourceMappingURL=events.js.map
