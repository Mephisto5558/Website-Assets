"use strict";(()=>{function a(e,t,n,i=!1){let s=document.createElement(e);if(t)for(let l of Object.keys(t)){let c=t[l];c!==void 0&&(typeof c=="object"&&c!=null&&!Array.isArray(c)&&l in s?Object.assign(s[l],c):s[l]=c)}return n&&(i?n.replaceChildren(s):n.append(s)),s}var I=200;var g=16,h=768,S=300,f=1e3,m={columnMode:"cards-column-mode",rowMode:"cards-row-mode"},p=document.body.querySelector("#header-container"),d=document.body.querySelector("#cards-container"),u=document.body.querySelector("#cards-container-pending"),D=document.body.querySelector("#feature-request-overlay"),T=a("input",{type:"text",placeholder:"Search",id:"search-box",value:new URLSearchParams(globalThis.location.search).get("q")??"",className:"grey-hover",maxLength:I});var r=class{static cardsCache=new Map;static user;static cardsOffset=0;static pageIsLoaded=!1;static smallScreen=!1};function L(e,t){let n;return(...i)=>new Promise((s,l)=>{clearTimeout(n),n=setTimeout(()=>{try{s(e(...i))}catch(c){l(c instanceof Error?c:new Error(c))}},t)})}var H=L(async(e,t)=>{if(!r.user?.id)return void Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to vote!"});let n=await C("vote/addvote",{method:"POST",body:JSON.stringify({featureId:e})});try{n=await n.json()}catch{}if(n.ok===!1||n.error)return void Swal.fire({icon:"error",title:"Oops...",text:n.error??n.statusText});Swal.fire({icon:"success",title:"Success",text:"Your vote has been successfully recorded."}),t.textContent=Number.parseInt(t.textContent)+1,r.cardsOffset=0,E()},f);async function C(e,t={},n=5e3){t.body!=null&&!t.headers&&(t.headers={"Content-Type":"application/json"}),t.signal??=new AbortController().signal;let i=setTimeout(()=>t.signal.abort("Request timed out"),n),s=await fetch(e?`/api/v1/internal/${e}`:void 0,t);return clearTimeout(i),s}function N(e,t){let n=new URL(globalThis.location.href),i=new URLSearchParams(globalThis.location.search);t?i.set(e,t):i.delete(e),n.search=i.toString(),globalThis.history.pushState(void 0,"",n.toString())}function E(e=T.value,t=26){e=e.toLowerCase(),N("q",e);let n=e?[...r.cardsCache.values()].filter(i=>i.title.toLowerCase().includes(e)||i.body?.toLowerCase().includes(e)||i.id.toLowerCase().includes(e)):[...r.cardsCache.values()];if(!n.length&&!d.childElementCount&&!u.childElementCount)return void a("h2",{textContent:`There are currently no feature requests${e?" matching your search query":""} :(`},d,!0);r.cardsOffset||(d.innerHTML="",u.innerHTML="");for(let i of n.slice(r.cardsOffset,t+r.cardsOffset))O(i);return r.cardsOffset+=t,r.cardsCache.size>r.cardsOffset&&(d.childElementCount+u.childElementCount<t?E(e,t):d.clientHeight<window.innerHeight&&E(e,Math.ceil((window.innerHeight-d.clientHeight)/(d.clientHeight/d.childElementCount)))),n}function O(e){let t=!!r.user?.dev,n=a("div",{className:"card",id:e.id}),i=a("h2",{id:"title",textContent:e.title,contentEditable:t?"plaintext-only":"false"},n),s=e.body||t?a("p",{id:"description",textContent:e.body??"",contentEditable:t?"plaintext-only":"false"},n):void 0,l=a("div",{className:"vote-buttons"},n),c=a("span",{className:"vote-counter",textContent:e.pending?"":(e.votes??0).toString()});e.pending&&t?a("button",{textContent:"Approve",className:"vote-button blue-button"},l).addEventListener("click",async()=>{let o=await C("vote/approve",{method:"POST",body:JSON.stringify({featureId:e.id})}).then(b=>b.json()).catch(b=>b);if(o.ok===!1||o.error)return void Swal.fire({icon:"error",title:"Oops...",text:o.error??o.statusText});Swal.fire({icon:"success",title:"Success",text:"The feature request has been approved."}),d.append(n),u.childElementCount||(document.body.querySelector("#new-requests")?.remove(),document.body.querySelector("#old-requests")?.remove(),document.body.querySelector("#feature-request-overlay + *").style.marginTop=`${p.clientHeight+g}px`)}):e.pending||a("button",{className:"vote-button blue-button",textContent:"Upvote"},l).addEventListener("click",()=>H(e.id,c)),l.append(c);let x=a("button",{title:"Copy card Id",className:"manage-button grey-hover"},l),w=a("i",{className:"far fa-copy fa-xl"},x);if(x.addEventListener("click",()=>{navigator.clipboard.writeText(e.id),w.classList="fas fa-check fa-xl",setTimeout(()=>w.classList="far fa-copy fa-xl",f*3)}),t&&(i.addEventListener("keydown",o=>{!(o.target instanceof HTMLElement)||!(o.target?.parentElement instanceof HTMLElement)||(o.target.parentElement.hasAttribute("modified")?o.target.textContent==e.title&&o.target.parentElement.removeAttribute("modified"):o.target.textContent!=e.title&&o.target.parentElement.setAttribute("modified",""),o.key==="Enter"&&(o.preventDefault(),o.target.nextElementSibling.firstChild.focus()))}),s?.addEventListener("input",({target:o})=>{o.parentElement.hasAttribute("modified")?o.textContent==e.body&&o.parentElement.removeAttribute("modified"):o.textContent!=e.body&&o.parentElement.setAttribute("modified","")})),t||r.user?.id==e.id.split("_")[0]){let o=a("button",{title:"Delete card",className:"manage-button grey-hover"},l);o.addEventListener("click",()=>Swal.fire({icon:"warning",title:"Are you sure?",text:"Are you sure you want to delete that card? This action cannot be undone!",showCancelButton:!0,preConfirm:async()=>{await C("vote/delete",{method:"DELETE",body:JSON.stringify({featureId:e.id})}),n.remove(),u.childElementCount||(document.body.querySelector("#new-requests")?.remove(),document.body.querySelector("#old-requests")?.remove(),document.body.querySelector("#feature-request-overlay + *").style.marginTop=`${p.clientHeight+g}px`)}})),a("i",{className:"far fa-trash-can fa-xl"},o)}t&&a("p",{id:"userId",title:"Click to copy",textContent:e.id.split("_")[0]},l).addEventListener("click",()=>navigator.clipboard.writeText(e.id.split("_")[0])),(e.pending?u:d).append(n),s?.value&&(s.style.height=`${s.scrollHeight}px`)}function M(){localStorage.setItem("displayMode",d.classList.contains(m.columnMode)?"cardsInRows":"cardsInColumns"),d.classList.toggle(m.columnMode),u.classList.toggle(m.columnMode),d.classList.toggle(m.rowMode),u.classList.toggle(m.rowMode)}var y;function A(e=y==="dark"?"light":"dark"){if(y!==e){y=e,localStorage.setItem("theme",y);for(let t of["bg","text","input-bg","input-focus-bg","card-bg","grey-text"])document.documentElement.style.setProperty(`--${t}-color`,`var(--${y}-mode-${t}-color)`);if(r.pageIsLoaded){let t=document.querySelectorAll("body, #header-container button, #header-container>#search-box, .card");for(let n of t)n.classList.add("color-transition");setTimeout(()=>{for(let n of t)n.classList.remove("color-transition")},S)}}}var X=void 0;T.addEventListener("input",L(e=>{if(!(e.target instanceof HTMLInputElement))return;e.target.value.length>e.target.maxLength&&(e.target.value=e.target.value.slice(0,e.target.maxLength)),r.cardsOffset=0;let t=E(e.target.value);document.querySelector("#feature-request-count > span").textContent=t.length.toLocaleString()},f/2));p.querySelector("#toggle-cards-display").addEventListener("click",()=>M());p.querySelector("#toggle-color-scheme").addEventListener("click",()=>A());window.addEventListener("scroll",()=>{r.cardsCache.size>r.cardsOffset&&document.documentElement.scrollTop+document.documentElement.clientHeight>=document.documentElement.scrollHeight-g&&E()});var v=window.innerWidth;window.addEventListener("resize",L(()=>{let e=window.innerWidth;v>=h&&e<h||v<h&&e>=h?globalThis.location.reload():v=e},f/2));window.addEventListener("beforeunload",e=>{document.body.querySelectorAll(".card[modified]").length&&e.preventDefault()});})();
//# sourceMappingURL=events.js.map
