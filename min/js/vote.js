(()=>{let d,l,r,n,i=!1,t=!1,a=!1,s=0,o=window.innerWidth,c=16,u=768,m=1e3,p={columnMode:"cards-column-mode",rowMode:"cards-row-mode"},v=document.body.querySelector("#header-container"),h=document.body.querySelector("#cards-container"),y=document.body.querySelector("#cards-container-pending"),g=document.body.querySelector("#feature-request-overlay"),b=E("input",{type:"text",placeholder:"Search",id:"search-box",value:new URLSearchParams(globalThis.location.search).get("q"),className:"grey-hover",maxLength:200}),e=(r,n)=>{let i;return(...o)=>new Promise((e,t)=>{clearTimeout(i),i=setTimeout(((e,t,...o)=>{try{e(r(...o))}catch(e){t(e instanceof Error?e:new Error(e))}}).bind(void 0,e,t,...o),n)})},f=(e={})=>{e.key&&"Escape"!==e.key||"none"===g.style.display||(v.removeAttribute("inert"),h.removeAttribute("inert"),y.removeAttribute("inert"),r&&r.removeAttribute("inert"),a&&h.style.removeProperty("display"),g.style.removeProperty("display"))},w=e(async t=>{t.preventDefault();t=t.target.parentElement;if(t.title&&t.description){let e=await q("vote/new",{method:"POST",body:JSON.stringify({title:t.title.value.trim(),description:t.description.value.trim()})});try{e=await e.json()}catch{}!1===e.ok||e.error?Swal.fire({icon:"error",title:"Oops...",text:e.error??e.statusText}):(await Swal.fire({icon:"success",title:"Success",text:`Your feature request has been submitted and ${e.approved?"approved":"will be reviewed shortly"}.`}),l.set(e.id,e),f(),t.reset())}},m),x=e(async(t,o)=>{if(d?.id){let e=await q("vote/addvote",{method:"POST",body:JSON.stringify({featureId:t})});try{e=await e.json()}catch{}!1===e.ok||e.error?Swal.fire({icon:"error",title:"Oops...",text:e.error??e.statusText}):(Swal.fire({icon:"success",title:"Success",text:"Your vote has been successfully recorded."}),o.textContent=Number.parseInt(o.textContent)+1)}else Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to vote!"})},m),S=e(async()=>{var t=[...document.body.querySelectorAll(".card[modified]")].reduce((e,t)=>{t.removeAttribute("modified");var o=l.get(t.id);return(o?.title&&t.children.title.textContent.trim()!==o.title||o.body&&t.children.description?.textContent.trim()!==o.body)&&e.push({id:t.id,title:t.children.title.textContent.trim(),body:t.children.description.textContent.trim()}),e},[]);if(t.length){let e=await q("vote/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});try{e=await e.json()}catch{}!1===e.ok||e.error?Swal.fire({icon:"error",title:"Oops...",text:e.error??e.statusText}):(Swal.fire({icon:"success",title:"Success",text:"The cards have been updated."}),s=0,l=await L(),C())}else Swal.fire({icon:"error",title:"Oops...",text:"No cards have been modified."})},m);async function q(e,t={},o=5e3){null==t.body||t.headers||(t.headers={"Content-Type":"application/json"}),t.signal??=(new AbortController).signal;o=setTimeout(()=>t.signal.abort("Request timed out"),o),e=await fetch(e?"/api/v1/internal/"+e:void 0,t);return clearTimeout(o),e}async function L(){return new Map((await q("vote/list?includePending="+!!d?.dev).then(e=>e.json()))?.cards?.sort((e,t)=>!e.pending&&t.pending?1:e.pending&&!t.pending?-1:(t.votes??0)-(e.votes??0)||e.title.localeCompare(t.title)).map(e=>[e.id,e]))}function E(e,t,o,r){var n=document.createElement(e);if(Object.keys(t??{}).length)for(var[i,a]of Object.entries(t))null!=a&&("object"==typeof a?Object.assign(n[i],a):n[i]=a);return o&&(r?o.replaceChildren(n):o.append(n)),n}function C(t=b.value,e=26){t=t.toLowerCase(),o="q",i=t,r=new URL(globalThis.location.href),n=new URLSearchParams(globalThis.location.search),i?n.set(o,i):n.delete(o),r.search=n.toString(),globalThis.history.pushState(void 0,void 0,r.toString());var o,r,n,i=t?[...l.values()].filter(e=>e.title.toLowerCase().includes(t)||e.body.toLowerCase().includes(t)||e.id.toLowerCase().includes(t)):[...l.values()];if(i.length||h.childElementCount||y.childElementCount){s||(h.innerHTML="",y.innerHTML="");for(var a of i.slice(s,e+s))(t=>{let o=E("div",{className:"card",id:t.id}),e=E("h2",{id:"title",textContent:t.title,contentEditable:d?.dev?"plaintext-only":"false"},o),r=t.body||d.dev?E("p",{id:"description",textContent:t.body,contentEditable:d?.dev?"plaintext-only":"false"},o):void 0,n=E("div",{className:"vote-buttons"},o),i=E("span",{className:"vote-counter",textContent:t.pending?"":t.votes??0}),a=(t.pending&&d.dev?E("button",{textContent:"Approve",className:"vote-button blue-button"},n).addEventListener("click",async()=>{let e=await q("vote/approve",{method:"POST",body:JSON.stringify({featureId:t.id})});try{e=await e.json()}catch{}!1===e.ok||e.error?Swal.fire({icon:"error",title:"Oops...",text:e.error??e.statusText}):(Swal.fire({icon:"success",title:"Success",text:"The feature request has been approved."}),h.append(o),y.childElementCount||(document.body.querySelector("#new-requests")?.remove(),document.body.querySelector("#old-requests")?.remove(),document.body.querySelector("#feature-request-overlay + *").style.marginTop=v.clientHeight+c+"px"))}):t.pending||E("button",{className:"vote-button blue-button",textContent:"Upvote"},n).addEventListener("click",()=>x(t.id,i)),n.append(i),E("button",{title:"Copy card Id",className:"manage-button grey-hover"},n)),l=E("i",{className:"far fa-copy fa-xl"},a);var s;a.addEventListener("click",()=>{navigator.clipboard.writeText(t.id),l.classList="fas fa-check fa-xl",setTimeout(()=>l.classList="far fa-copy fa-xl",3*m)}),d.dev&&(e.addEventListener("keydown",e=>{e.target.parentElement.hasAttribute("modified")||e.target.parentElement.setAttribute("modified",""),"Enter"===e.key&&(e.preventDefault(),e.target.nextElementSibling.firstChild.focus())}),r?.addEventListener("input",({target:e})=>{e.parentElement.hasAttribute("modified")||e.parentElement.setAttribute("modified","")})),!d.dev&&d.id!=t.id.split("_")[0]||((s=E("button",{title:"Delete card",className:"manage-button grey-hover"},n)).addEventListener("click",()=>Swal.fire({icon:"warning",title:"Are you sure?",text:"Are you sure you want to delete that card? This action cannot be undone!",showCancelButton:!0,preConfirm:async()=>{await q("vote/delete",{method:"DELETE",body:JSON.stringify({featureId:t.id})}),o.remove(),y.childElementCount||(document.body.querySelector("#new-requests")?.remove(),document.body.querySelector("#old-requests")?.remove(),document.body.querySelector("#feature-request-overlay + *").style.marginTop=v.clientHeight+c+"px")}})),E("i",{className:"far fa-trash-can fa-xl"},s)),d.dev&&E("p",{id:"userId",title:"Click to copy",textContent:t.id.split("_")[0]},n).addEventListener("click",()=>navigator.clipboard.writeText(t.id.split("_")[0])),(t.pending?y:h).append(o),r?.value&&(r.style.height=r.scrollHeight+"px")})(a);return s+=e,l.size>s&&(h.childElementCount+y.childElementCount<e?C(t,e):h.clientHeight<window.innerHeight&&C(t,Math.ceil((window.innerHeight-h.clientHeight)/(h.clientHeight/h.childElementCount)))),i}E("h2",{textContent:`There are currently no feature requests${t?" matching your search query":""} :(`},h,!0)}function T(e="dark"===n?"light":"dark"){if(n!==e){n=e,localStorage.setItem("theme",n);for(var t of["bg","text","input-bg","input-focus-bg","card-bg","grey-text"])document.documentElement.style.setProperty(`--${t}-color`,`var(--${n}-mode-${t}-color)`);if(i){let t=document.querySelectorAll("body, #header-container button, #header-container>#search-box, .card");for(var o of t)o.classList.add("color-transition");setTimeout(()=>{for(var e of t)e.classList.remove("color-transition")},300)}}}b.addEventListener("input",e(({target:e})=>{e.value.length>e.maxLength&&(e.value=e.value.slice(0,e.maxLength)),s=0;e=C(e.value);document.querySelector("#feature-request-count > span").textContent=(d.dev?e:e.filter(e=>!e.pending)).length},m/2)),v.querySelector("#toggle-cards-display").addEventListener("click",()=>{(t=!t)?(localStorage.setItem("displayMode","cardsInRows"),h.classList.remove(p.columnMode),y.classList.remove(p.columnMode),h.classList.add(p.rowMode),y.classList.add(p.rowMode)):(localStorage.setItem("displayMode","cardsInColumns"),h.classList.remove(p.rowMode),y.classList.remove(p.rowMode),h.classList.add(p.columnMode),y.classList.add(p.columnMode))}),v.querySelector("#toggle-color-scheme").addEventListener("click",()=>T()),window.addEventListener("scroll",()=>{l.size>s&&document.documentElement.scrollTop+document.documentElement.clientHeight>=document.documentElement.scrollHeight-c&&C()}),window.addEventListener("resize",e(()=>{var e=window.innerWidth;o>=u&&e<u||o<u&&e>=u?globalThis.location.reload():o=e},m/2)),window.addEventListener("beforeunload",e=>{document.body.querySelectorAll(".card[modified]").length&&e.preventDefault()}),document.addEventListener("DOMContentLoaded",async()=>{T(localStorage.getItem("theme")??(globalThis.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark")),(a=globalThis.matchMedia("(max-width: 768px)").matches)||(t="cardsInRows"===localStorage.getItem("displayMode")),await(async()=>{var e=document.createDocumentFragment();let t=E("div",{id:"profile-container"});if(!(d=await q("user").then(e=>e.json()).catch(()=>{}))||d.errorCode)return 403==d?.errorCode?E("h2",{textContent:d.error},document.body,!0):(e.append(b),E("button",{id:"feature-request-button",textContent:a?"New Request":"New Feature Request",className:"grey-hover"},e),E("button",{id:"login-button",textContent:a?"Login":"Login with Discord",className:"blue-button"},t).addEventListener("click",()=>globalThis.location.href="/auth/discord?redirectURL="+globalThis.location.href),e.append(t),v.append(e));let o=E("div",{id:"profile-container-wrapper"},t),r=(t.addEventListener("click",()=>o.style.display="flex"===o.style.display?"none":"flex"),new Image(39,39));r.onload=()=>t.append(r),r.alt="Profile",r.src=`https://cdn.discordapp.com/avatars/${d.id}/${d.avatar}.webp?size=64`,E("div",{id:"username",textContent:d.displayName??d.username},o),E("button",{id:"logout-button",textContent:"Logout",className:"blue-button"},o).addEventListener("click",async()=>{var e=await fetch("/auth/logout");await Swal.fire(e.ok?{icon:"success",title:"Success",text:"You are now logged out."}:{icon:"error",title:"Logout failed",text:e.statusText}),e.ok&&globalThis.location.reload()});var n=E("button",{id:"feature-request-button",textContent:a?"New Request":"New Feature Request",className:"grey-hover"});a?(E("br",e),e.append(t),e.append(b),e.append(n)):(e.append(b),e.append(n),e.append(t)),v.append(e)})();{var e=g.querySelector("#feature-request-modal");e.querySelector("#feature-request-submit-button").addEventListener("click",w),v.querySelector("#feature-request-button").addEventListener("click",()=>{if(!d?.id)return Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to create a feature request!"});v.inert=!0,h.inert=!0,y.inert=!0,r&&(r.inert=!0),g.style.display="block",a&&(h.style.display="none")}),e.querySelector("#feature-request-reset-btn").addEventListener("click",f),document.addEventListener("keydown",f),d.dev&&e.querySelector("#feature-request-description").removeAttribute("required");let t=e.querySelector("#title-counter"),o=e.querySelector("#description-counter");e.querySelector("#feature-request-title").addEventListener("input",e=>{t.textContent=e.target.value.length+"/140",140<=e.target.value.length?t.classList.add("limit-reached"):t.classList.remove("limit-reached")}),e.querySelector("#feature-request-description").addEventListener("input",e=>{o.textContent=e.target.value.length+"/4000",4e3<=e.target.value.length?o.classList.add("limit-reached"):o.classList.remove("limit-reached")})}l=await L(),h.classList.add(t?p.rowMode:p.columnMode),y.classList.add(t?p.rowMode:p.columnMode),document.querySelector("#feature-request-count > span").textContent=d.dev?l.size:[...l.values()].filter(e=>!e.pending).length,"#new"==globalThis.location.hash&&v.querySelector("#feature-request-button").click(),navigator.clipboard??={writeText:e=>Swal.fire({icon:"error",title:"Copying is not available due to this page being served over HTTP.",text:"This was what you tried to copy: "+e})},C(),d.dev&&(y.childElementCount&&(document.body.insertBefore(E("h2",{id:"new-requests",textContent:"New Requests"}),y),document.body.insertBefore(E("h2",{id:"old-requests",textContent:"Approved Requests"}),h)),r=E("button",{id:"save-button",title:"Save",classList:"blue-button"},document.body),E("i",{classList:"fas fa-save fa-xl"},r),r.addEventListener("click",S)),document.body.querySelector("#feature-request-overlay + *").style.marginTop=v.clientHeight+c+"px",document.documentElement.style.scrollPaddingTop=v.clientHeight+20+"px",i=!0})})();