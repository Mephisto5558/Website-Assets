(()=>{let e,t,n,r,l,o,i=0,a=document.querySelector(".header-container"),s=document.querySelector(".profile-container"),d=document.getElementById("cards-container"),c=document.getElementById("search-box"),u=(e,t,n=5e3)=>new Promise((r,l)=>{let o=setTimeout(()=>l(Error("Request timed out")),n);fetch(e?`/api/v1/internal/${e}`:null,t).then(r).catch(l).finally(()=>clearTimeout(o))});function m(e,t,n,r,l,o="append"){let i=document.createElement(e);return null!=t&&(i.className=t),null!=n&&(i.id=n),null!=r&&(i.textContent=r),l&&("replace"==o?l.replaceChildren(i):l.appendChild(i)),i}function g(e,t){let n=new URL(window.location.href),r=new URLSearchParams(window.location.search);t?r.set(e,t):r.delete(e),n.search=r.toString(),window.history.pushState(null,null,n.toString())}async function h(t){if((e=await u("user").catch(()=>{}).then(e=>e.json()))?.error||!e)return m("button","login-button",null,t?"Login":"Login with Discord",s).addEventListener("click",()=>window.location.href=`/auth/discord?redirectURL=${window.location.href}`);let n=m("div","profile-container-wrapper"),r=m("img","profile-image",null,null,s);r.src=`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.webp`,r.alt="Profile",r.addEventListener("click",()=>n.style.display="block"===n.style.display?"none":"block"),m("div","username",null,e.displayName||`${e.username}#${e.discriminator}`,n),m("button","logout-button",null,"Logout",n).addEventListener("click",async()=>{let e=await fetch("/auth/logout");if(!e.ok)return Swal.fire({icon:"error",title:"Logout failed",text:e.statusText});await Swal.fire({icon:"success",title:"Success",text:"You are now logged out."}),window.location.reload()}),s.appendChild(n)}async function p(){let t=document.getElementById("feature-request-overlay");document.getElementById("feature-request-button").addEventListener("click",()=>{if(!e?.id)return Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to send a feature request!"});t.style.display="block"}),t.addEventListener("click",e=>{e.target===t&&(t.style.display="none")});let n=document.getElementById("title-counter"),r=document.getElementById("description-counter");document.getElementById("feature-request-title").addEventListener("input",e=>{n.textContent=`${e.target.value.length}/140`,e.target.value.length>=140?n.classList.add("limit-reached"):n.classList.remove("limit-reached")}),document.getElementById("feature-request-description").addEventListener("input",e=>{r.textContent=`${e.target.value.length}/4000`,e.target.value.length>=4e3?r.classList.add("limit-reached"):r.classList.remove("limit-reached")}),document.getElementById("feature-request-modal").addEventListener("submit",E)}function y(e=c.value,n=25){g("q",e=e?.toLowerCase());let r=t.slice(i,n+i);if(e&&(r=r.filter(t=>t.title.toLowerCase().includes(e)||t.body.toLowerCase().includes(e)||t.id.toLowerCase().includes(e))),!r.length&&!d.childElementCount)return m("h2",null,null,`There are currently no feature requests${e?" matching your search query.":""} :(`,d,"replace");for(let l of(i||(d.innerHTML=""),r))f(l);i+=n,d.childElementCount<n&&t.length>i&&y(...arguments)}function f(e){let t=m("div","card",e.id);e.title&&m("h2",null,null,e.title,t),e.body&&m("p",null,null,e.body,t);let n=m("div","vote-buttons",null,null,t),r=m("span","vote-counter",null,e.votes??0);m("button","vote-button",null,"Upvote",n).addEventListener("click",()=>L(e.id,r)),n.appendChild(r);let l=m("button","copy-button",null,null,n);l.title="Copy card Id",l.addEventListener("click",()=>navigator.clipboard.writeText(e.id)),m("i","fa-regular fa-copy fa-xl",null,null,l),d.appendChild(t)}function v(){let e=document.getElementById("cards-container");(o=!o)?(localStorage.setItem("displayMode","cardsInRows"),e.classList.remove("cards-column-mode"),e.classList.add("cards-row-mode")):(localStorage.setItem("displayMode","cardsInColumns"),e.classList.remove("cards-row-mode"),e.classList.add("cards-column-mode"))}async function b(t){if(r=t||("dark"===r?"light":"dark"),localStorage.setItem("theme",r),t||"636196723852705822"!=e.id||await Swal.fire({icon:"light"===r?"error":"success",title:"Hallo Koi",text:"light"===r?"Du kriegst keinen Lightmode, ist ungesund!":"Welcome to the dark side!"}),["bg","text","input-bg","input-focus-bg","card-bg"].forEach(e=>document.documentElement.style.setProperty(`--${e}-color`,`var(--${r}-mode-${e}-color)`)),l){let n=document.querySelectorAll("body, #search-box, #feature-request-button, .header-container #toggle-cards-display, .header-container #toggle-light-mode, .login-button, .logout-button, .card");for(let o of n)o.classList.add("color-transition");setTimeout(()=>n.forEach(e=>e.classList.remove("color-transition")),300)}}async function E(t){t.preventDefault();let n=await u("vote/new",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t.target.title.value.trim(),description:t.target.description.value.trim(),authorId:e.id})}).then(e=>e.json());return n.error?Swal.fire({icon:"error",title:"Oops...",text:n.error}):(await Swal.fire({icon:"success",title:"Success",text:`Your feature request has been submitted and ${n.approved?"approved":"will be reviewed shortly"}.`}),n.approved)?window.location.reload():void(t.target.reset(),document.getElementById("feature-request-overlay").style.display="none")}async function L(t,n){if(!e?.id)return Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to vote!"});let r=await u("vote/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({featureId:t,userId:e?.id})}).then(e=>e.json());if(r.error)return Swal.fire({icon:"error",title:"Oops...",text:r.error});Swal.fire({icon:"success",title:"Success",text:"Your vote has been successfully recorded."}),n.textContent=parseInt(n.textContent)+1}c.addEventListener("input",({target:e})=>{clearTimeout(n),n=setTimeout(()=>{i=0,y(e.value)},500)}),document.getElementById("toggle-cards-display").addEventListener("click",()=>v()),document.getElementById("toggle-color-scheme").addEventListener("click",()=>b()),window.addEventListener("scroll",()=>{t.length>i&&document.documentElement.scrollTop+document.documentElement.clientHeight>=document.documentElement.scrollHeight-15&&y()}),document.addEventListener("DOMContentLoaded",async()=>{b(localStorage.getItem("theme")||window.matchMedia("(prefers-color-scheme: light)").matches&&"light"||"dark");let e=new URLSearchParams(window.location.search).get("q");e&&(c.value=e);let n=window.matchMedia("(max-width: 768px)").matches;n?(o=!1,document.getElementById("feature-request-button").textContent="New",a.insertBefore(s,c),a.insertBefore(document.createElement("br"),c)):o="cardsInRows"===localStorage.getItem("displayMode"),await h(n),p(),t=(await u("vote/list").then(e=>e.json()))?.cards?.sort((e,t)=>t.votes-e.votes)||[],d.classList.add(o?"cards-row-mode":"cards-column-mode"),d.style.marginTop=`${a.clientHeight+16}px`,y(),l=!0})})();