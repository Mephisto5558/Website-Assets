(()=>{let e,t,n,r,o,a,i=!1,s=0,l=window.innerWidth,d=document.getElementById("header-container"),c=document.getElementById("cards-container"),u=document.getElementById("cards-container-pending"),m=h("input",{type:"text",placeholder:"Search",id:"search-box",query:new URLSearchParams(window.location.search).get("q"),className:"grey-hover"});m.addEventListener("input",({target:e})=>{clearTimeout(n),n=setTimeout(()=>{s=0,v(e.value)},500)});let p=(e,t,n=5e3)=>new Promise((r,o)=>{let a=setTimeout(()=>o(Error("Request timed out")),n);fetch(e?`/api/v1/internal/${e}`:null,t).then(r).catch(o).finally(()=>clearTimeout(a))});function h(e,t,n,r){let o=document.createElement(e);if(Object.keys(t||{}).length)for(let[a,i]of Object.entries(t))o[a]=i;return n&&(r?n.replaceChildren(o):n.appendChild(o)),o}function y(e,t){let n=new URL(window.location.href),r=new URLSearchParams(window.location.search);t?r.set(e,t):r.delete(e),n.search=r.toString(),window.history.pushState(null,null,n.toString())}async function g(t){let n=document.createDocumentFragment(),r=h("div",{id:"profile-container"});if((e=await p("user").catch(()=>{}).then(e=>e.json()))?.error||!e)return n.appendChild(m),h("button",{id:"feature-request-button",textContent:t?"New Request":"New Feature Request",className:"grey-hover"},n),h("button",{id:"login-button",textContent:t?"Login":"Login with Discord",className:"blue-button"},r).addEventListener("click",()=>window.location.href=`/auth/discord?redirectURL=${window.location.href}`),n.appendChild(r),d.appendChild(n);h("img",{id:"profile-image",alt:"Profile",src:`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.webp`},r).addEventListener("click",()=>o.style.display="block"===o.style.display?"none":"block");let o=h("div",{id:"profile-container-wrapper"},r);h("div",{id:"username",textContent:e.displayName||`${e.username}#${e.discriminator}`},o),h("button",{id:"logout-button",textContent:"Logout",className:"blue-button"},o).addEventListener("click",async()=>{let e=await fetch("/auth/logout");await Swal.fire(e.ok?{icon:"success",title:"Success",text:"You are now logged out."}:{icon:"error",title:"Logout failed",text:e.statusText}),e.ok&&window.location.reload()});let a=h("button",{id:"feature-request-button",textContent:t?"New Request":"New Feature Request",className:"grey-hover"});t?(h("br",n),n.appendChild(r),n.appendChild(m),n.appendChild(a)):(n.appendChild(m),n.appendChild(a),n.appendChild(r)),d.appendChild(n)}async function f(t){let n=document.getElementById("feature-request-overlay");document.getElementById("feature-request-button").addEventListener("click",()=>{if(!e?.id)return Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to create a feature request!"});n.style.display="block",t&&(c.style.display="none")});let r=document.querySelector("#feature-request-modal>button"),o=({target:e,key:r})=>{"none"===n.style.display||r&&"Escape"!==r||(t&&(c.style.display=""),n.style.display="none")};r.addEventListener("click",o),document.addEventListener("keydown",o);let a=document.getElementById("title-counter"),i=document.getElementById("description-counter");document.getElementById("feature-request-title").addEventListener("input",e=>{a.textContent=`${e.target.value.length}/140`,e.target.value.length>=140?a.classList.add("limit-reached"):a.classList.remove("limit-reached")}),document.getElementById("feature-request-description").addEventListener("input",e=>{i.textContent=`${e.target.value.length}/4000`,e.target.value.length>=4e3?i.classList.add("limit-reached"):i.classList.remove("limit-reached")}),document.getElementById("feature-request-modal").addEventListener("submit",E)}function v(e=m.value,n=26){y("q",e=e?.toLowerCase());let r=t.slice(s,n+s);if(e&&(r=r.filter(t=>t.title.toLowerCase().includes(e)||t.body.toLowerCase().includes(e)||t.id.toLowerCase().includes(e))),!r.length&&!c.childElementCount&&!u.childElementCount)return h("h2",{textContent:`There are currently no feature requests${e?" matching your search query":""} :(`},c,!0);for(let o of(s||(c.innerHTML="",u.innerHTML=""),r))b(o);if(s+=n,c.childElementCount+u.childElementCount<n&&t.length>s)return v(...arguments);u.childElementCount&&(document.body.insertBefore(h("h2",{id:"new-requests",textContent:"New Requests"}),u),document.body.insertBefore(h("h2",{id:"old-requests",textContent:"Approved Requests"}),c))}function b(t){let n=h("div",{className:"card",id:t.id});t.title&&h("h2",{textContent:t.title},n),t.body&&h("p",{id:"description",textContent:t.body},n);let r=h("div",{className:"vote-buttons"},n),o=h("span",{className:"vote-counter",textContent:t.pending?"":t.votes??0});t.pending?h("button",{textContent:"Approve",className:"vote-button blue-button"},r).addEventListener("click",async()=>{let e=await p(`vote/approve?featureId=${t.id}`).then(e=>e.json());if(e.error)return Swal.fire({icon:"error",title:"Oops...",text:e.error});Swal.fire({icon:"success",title:"Success",text:"The feature request has been approved."}),c.appendChild(n)}):h("button",{className:"vote-button blue-button",textContent:"Upvote"},r).addEventListener("click",()=>w(t.id,o)),r.appendChild(o);let a=h("button",{title:"Copy card Id",className:"manage-button grey-hover"},r);if(a.addEventListener("click",()=>navigator.clipboard.writeText(t.id)),h("i",{className:"fa-regular fa-copy fa-xl"},a),e.dev){let i=h("button",{title:"Delete card",className:"manage-button grey-hover"},r);i.addEventListener("click",()=>Swal.fire({icon:"warning",title:"Are you sure?",text:"Are you sure you want to delete that card? This action cannot be undone!",showCancelButton:!0,preConfirm(){p(`vote/delete?featureId=${n.id}`).then(e=>e.statusText),n.remove()}})),h("i",{className:"fa-regular fa-trash-can fa-xl"},i),h("p",{id:"userId",title:"Click to copy",textContent:t.id.split("_")[0]},r).addEventListener("click",()=>navigator.clipboard.writeText(t.id.split("_")[0]))}(t.pending?u:c).appendChild(n)}function C(){(i=!i)?(localStorage.setItem("displayMode","cardsInRows"),c.classList.remove("cards-column-mode"),c.classList.add("cards-row-mode"),u.classList.remove("cards-column-mode"),u.classList.add("cards-row-mode")):(localStorage.setItem("displayMode","cardsInColumns"),c.classList.remove("cards-row-mode"),c.classList.add("cards-column-mode"),u.classList.remove("cards-row-mode"),u.classList.add("cards-column-mode"))}async function L(e){if(o=e||("dark"===o?"light":"dark"),localStorage.setItem("theme",o),["bg","text","input-bg","input-focus-bg","card-bg"].forEach(e=>document.documentElement.style.setProperty(`--${e}-color`,`var(--${o}-mode-${e}-color)`)),a){let t=document.querySelectorAll("body, #header-container button, #header-container>#search-box, .card");for(let n of t)n.classList.add("color-transition");setTimeout(()=>t.forEach(e=>e.classList.remove("color-transition")),300)}}async function E(e){e.preventDefault();let t=await p("vote/new",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e.target.title.value.trim(),description:e.target.description.value.trim()})}).then(e=>e.json());if(t.error)return Swal.fire({icon:"error",title:"Oops...",text:t.error});await Swal.fire({icon:"success",title:"Success",text:`Your feature request has been submitted and ${t.approved?"approved":"will be reviewed shortly"}.`}),b(t),e.target.reset(),smallScreen&&(c.style.display=""),document.getElementById("feature-request-overlay").style.display="none"}async function w(t,n){if(!e?.id)return Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to vote!"});let r=await p(`vote/save?featureId=${t}`).then(e=>e.json());if(r.error)return Swal.fire({icon:"error",title:"Oops...",text:r.error});Swal.fire({icon:"success",title:"Success",text:"Your vote has been successfully recorded."}),n.textContent=parseInt(n.textContent)+1}document.getElementById("toggle-cards-display").addEventListener("click",()=>C()),document.getElementById("toggle-color-scheme").addEventListener("click",()=>L()),window.addEventListener("scroll",()=>{t.length>s&&document.documentElement.scrollTop+document.documentElement.clientHeight>=document.documentElement.scrollHeight-15&&v()}),window.addEventListener("resize",()=>{clearTimeout(r),r=setTimeout(()=>{let e=window.innerWidth;l>769&&e<768||l<768&&e>769?window.location.reload():l=e},500)}),window.addEventListener("load",()=>"#new"==window.location.hash?document.getElementById("feature-request-button").click():void 0),document.addEventListener("DOMContentLoaded",async()=>{L(localStorage.getItem("theme")||window.matchMedia("(prefers-color-scheme: light)").matches&&"light"||"dark");let e=window.matchMedia("(max-width: 768px)").matches;e||(i="cardsInRows"===localStorage.getItem("displayMode")),await g(e),f(e),t=(await p("vote/list?includePending=true").then(e=>e.json()))?.cards?.sort((e,t)=>(t.pending&&!e.pending?-1e9:0)-(e.votes-t.votes||t.title.localeCompare(e.title)))||[],c.classList.add(i?"cards-row-mode":"cards-column-mode"),u.classList.add(i?"cards-row-mode":"cards-column-mode"),v(),document.querySelector("#feature-request-overlay + *").style.marginTop=`${d.clientHeight+16}px`,a=!0})})();