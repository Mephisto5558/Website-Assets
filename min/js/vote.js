(()=>{let e,t,n,l=0,r,o,i=localStorage.getItem("displayMode")?"cardsInRows"===localStorage.getItem("displayMode"):!navigator.userAgentData?.mobile,a=document.getElementById("cards-container"),s=document.getElementById("search-box"),d=(e,t,n=5e3)=>new Promise((l,r)=>{let o=setTimeout(()=>r(Error("Request timed out")),n);fetch(e?`/api/v1/internal/${e}`:null,t).then(l).catch(r).finally(()=>clearTimeout(o))});function c(e,t,n,l,r,o="append"){let i=document.createElement(e);return t&&(i.className=t),n&&(i.id=n),l&&(i.textContent=l),r&&("replace"==o?r.replaceChildren(i):r.appendChild(i)),i}function u(e,t){let n=new URL(window.location.href),l=new URLSearchParams(window.location.search);t?l.set(e,t):l.delete(e),n.search=l.toString(),window.history.pushState(null,null,n.toString())}async function m(){e=await d("user").catch(()=>{}).then(e=>e.json());let t=document.querySelector(".profile-container");if(e?.error||!e)return c("button","login-button",null,"Login with Discord",t).addEventListener("click",()=>window.location.href=`/auth/discord?redirectURL=${window.location.href}`);let n=c("div","profile-container-wrapper"),l=c("img","profile-image",null,null,t);l.src=`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.webp`,l.alt="Profile",l.addEventListener("click",()=>n.style.display="block"===n.style.display?"none":"block"),c("div","username",null,e.displayName||`${e.username}#${e.discriminator}`,n),c("button","logout-button",null,"Logout",n).addEventListener("click",async()=>{let e=await fetch("/auth/logout");if(!e.ok)return Swal.fire({icon:"error",title:"Logout failed",text:e.statusText});await Swal.fire({icon:"success",title:"Success",text:"You are now logged out."}),window.location.reload()}),t.appendChild(n)}async function g(){let t=document.getElementById("feature-request-overlay");document.getElementById("feature-request-button").addEventListener("click",()=>{if(!e?.id)return Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to send a feature request!"});t.style.display="block"}),t.addEventListener("click",e=>{e.target===t&&(t.style.display="none")});let n=document.getElementById("title-counter"),l=document.getElementById("description-counter");document.getElementById("feature-request-title").addEventListener("input",e=>{n.textContent=`${e.target.value.length}/140`,e.target.value.length>=140?n.classList.add("limit-reached"):n.classList.remove("limit-reached")}),document.getElementById("feature-request-description").addEventListener("input",e=>{l.textContent=`${e.target.value.length}/4000`,e.target.value.length>=4e3?l.classList.add("limit-reached"):l.classList.remove("limit-reached")}),document.getElementById("feature-request-modal").addEventListener("submit",v)}function h(e=s.value,n=25){u("q",e=e?.toLowerCase());let r=t.slice(l,n+l);if(e&&(r=r.filter(t=>t.title.toLowerCase().includes(e)||t.body.toLowerCase().includes(e)||t.id.toLowerCase().includes(e))),!r.length&&!a.childElementCount)return c("h2",null,null,`There are currently no feature requests${e?" matching your search query.":""} :(`,a,"replace");for(let o of(l||(a.innerHTML=""),r))p(o);l+=n,a.childElementCount<n&&h(...arguments)}function p(e){let t=c("div","card",e.id);e.title&&c("h2",null,null,e.title,t),e.body&&c("p",null,null,e.body,t);let n=c("div","vote-buttons",null,null,t);c("button","vote-button",null,"Upvote",n).addEventListener("click",()=>b(e.id,upvoteCounterElement)),c("span","vote-counter",null,e.votes??0,null,n);let l=c("button","copy-button",null,null,n);l.title="Copy card Id",l.addEventListener("click",()=>navigator.clipboard.writeText(e.id)),c("i","fa-regular fa-copy fa-xl",null,null,l),a.appendChild(t)}function y(){let e=document.getElementById("cards-container");(i=!i)?(localStorage.setItem("displayMode","cardsInRows"),e.classList.remove("cards-column-mode"),e.classList.add("cards-row-mode")):(localStorage.setItem("displayMode","cardsInColumns"),e.classList.remove("cards-row-mode"),e.classList.add("cards-column-mode"))}async function f(t){if(r=t||("dark"===r?"light":"dark"),localStorage.setItem("theme",r),t||"636196723852705822"!=e.id||await Swal.fire({icon:"light"===r?"error":"success",title:"Hallo Koi",text:"light"===r?"Du kriegst keinen Lightmode, ist ungesund!":"Welcome to the dark side!"}),["bg","text","input-bg","input-focus-bg","card-bg"].forEach(e=>document.documentElement.style.setProperty(`--${e}-color`,`var(--${r}-mode-${e}-color)`)),o){let n=document.querySelectorAll("body, #search-box, #feature-request-button, .header-container #toggle-cards-display, .header-container #toggle-light-mode, .login-button, .logout-button, .card");for(let l of n)l.classList.add("color-transition");setTimeout(()=>n.forEach(e=>e.classList.remove("color-transition")),300)}}async function v(t){t.preventDefault();let n=await d("vote/new",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t.target.title.value.trim(),description:t.target.description.value.trim(),authorId:e.id})}).then(e=>e.json());return n.error?Swal.fire({icon:"error",title:"Oops...",text:n.error}):(await Swal.fire({icon:"success",title:"Success",text:`Your feature request has been submitted and ${n.approved?"approved":"will be reviewed shortly"}.`}),n.approved)?window.location.reload():void(t.target.reset(),document.getElementById("feature-request-overlay").style.display="none")}async function b(t,n){if(!e?.id)return Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to vote!"});let l=await d("vote/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({featureId:t,userId:e?.id})}).then(e=>e.json());if(l.error)return Swal.fire({icon:"error",title:"Oops...",text:l.error});Swal.fire({icon:"success",title:"Success",text:"Your vote has been successfully recorded."}),n.textContent=parseInt(n.textContent)+1}s.addEventListener("input",({target:e})=>{clearTimeout(n),n=setTimeout(()=>{l=0,h(e.value)},500)}),document.getElementById("toggle-cards-display").addEventListener("click",()=>y()),document.getElementById("toggle-color-scheme").addEventListener("click",()=>f()),window.addEventListener("scroll",()=>{t.length>l&&document.documentElement.scrollTop+document.documentElement.clientHeight>=document.documentElement.scrollHeight-15&&h()}),document.addEventListener("DOMContentLoaded",async()=>{f(localStorage.getItem("theme")||window.matchMedia("(prefers-color-scheme: light)").matches&&"light"||"dark");let e=new URLSearchParams(window.location.search).get("q");e&&(s.value=e),await m(),g(),t=(await d("vote/list").then(e=>e.json()))?.cards||[],a.classList.add(i?"cards-row-mode":"cards-column-mode"),a.style.marginTop=`${document.querySelector(".header-container").clientHeight+16}px`,h(),o=!0})})();