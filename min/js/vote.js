(()=>{let e,t,n,l,r,o,a,i=0,d=window.innerWidth,s=document.querySelector(".header-container"),c=document.getElementById("cards-container"),u=h("input","grey-hover","search-box");u.placeholder="Search",u.type="Text";let p=(e,t,n=5e3)=>new Promise((l,r)=>{let o=setTimeout(()=>r(Error("Request timed out")),n);fetch(e?`/api/v1/internal/${e}`:null,t).then(l).catch(r).finally(()=>clearTimeout(o))});function h(e,t,n,l,r,o="append"){let a=document.createElement(e);return null!=t&&(a.className=t),null!=n&&(a.id=n),null!=l&&(a.textContent=l),r&&("replace"==o?r.replaceChildren(a):r.appendChild(a)),a}function m(e,t){let n=new URL(window.location.href),l=new URLSearchParams(window.location.search);t?l.set(e,t):l.delete(e),n.search=l.toString(),window.history.pushState(null,null,n.toString())}async function g(t){let n=document.createDocumentFragment(),l=h("div","profile-container");if((e=await p("user").catch(()=>{}).then(e=>e.json()))?.error||!e)return n.appendChild(u),h("button","grey-hover","feature-request-button","New Feature Request",n),h("button","login-button blue-button",null,t?"Login":"Login with Discord",l).addEventListener("click",()=>window.location.href=`/auth/discord?redirectURL=${window.location.href}`),n.appendChild(l),s.appendChild(n);let r=h("img","profile-image",null,null,l),o=h("div","profile-container-wrapper",null,null,l);r.src=`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.webp`,r.alt="Profile",r.addEventListener("click",()=>o.style.display="block"===o.style.display?"none":"block"),h("div","username",null,e.displayName||`${e.username}#${e.discriminator}`,o),h("button","logout-button blue-button",null,"Logout",o).addEventListener("click",async()=>{let e=await fetch("/auth/logout");if(!e.ok)return Swal.fire({icon:"error",title:"Logout failed",text:e.statusText});await Swal.fire({icon:"success",title:"Success",text:"You are now logged out."}),window.location.reload()});let a=h("button","grey-hover","feature-request-button",t?"New":"New Feature Request"),i=new URLSearchParams(window.location.search).get("q");i&&(u.value=i),t?(h("br",null,null,null,s),n.appendChild(l),n.appendChild(u),n.appendChild(a)):(n.appendChild(u),n.appendChild(a),n.appendChild(l)),s.appendChild(n)}async function y(){let t=document.getElementById("feature-request-overlay");document.getElementById("feature-request-button").addEventListener("click",()=>{if(!e?.id)return Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to send a feature request!"});t.style.display="block"}),t.addEventListener("click",e=>{"block"===t.style.display&&(t.style.display="none")}),document.addEventListener("keydown",e=>{"Escape"===e.key&&"block"===t.style.display&&(t.style.display="none")});let n=document.getElementById("title-counter"),l=document.getElementById("description-counter");document.getElementById("feature-request-title").addEventListener("input",e=>{n.textContent=`${e.target.value.length}/140`,e.target.value.length>=140?n.classList.add("limit-reached"):n.classList.remove("limit-reached")}),document.getElementById("feature-request-description").addEventListener("input",e=>{l.textContent=`${e.target.value.length}/4000`,e.target.value.length>=4e3?l.classList.add("limit-reached"):l.classList.remove("limit-reached")}),document.getElementById("feature-request-modal").addEventListener("submit",L)}function f(n=u.value,l=26){m("q",n=n?.toLowerCase());let r=t.slice(i,l+i);if(n&&(r=r.filter(e=>e.title.toLowerCase().includes(n)||e.body.toLowerCase().includes(n)||e.id.toLowerCase().includes(n))),!r.length&&!c.childElementCount)return h("h2",null,null,`There are currently no feature requests${n?" matching your search query.":""} :(`,c,"replace");for(let o of(i||(c.innerHTML=""),r))v(o);if(e.dev)for(let a of c.querySelectorAll(".vote-buttons")){let d=h("button","manage-button grey-hover",null,null,a);d.title="Delete card",d.addEventListener("click",async()=>{await Swal.fire({icon:"warning",title:"Are you sure?",text:"Are you sure you want to delete that card? This action cannot be undone!",showCancelButton:!0,preConfirm:()=>p(`vote/delete?featureId=${a.parentElement.id}&userId=${e.id}`).then(e=>e.statusText)}),a.parentElement.remove()}),h("i","fa-regular fa-trash-can fa-xl",null,null,d)}i+=l,c.childElementCount<l&&t.length>i&&f(...arguments)}function v(e){let t=h("div","card",e.id);e.title&&h("h2",null,null,e.title,t),e.body&&h("p",null,null,e.body,t);let n=h("div","vote-buttons",null,null,t),l=h("span","vote-counter",null,e.votes??0);h("button","vote-button blue-button",null,"Upvote",n).addEventListener("click",()=>w(e.id,l)),n.appendChild(l);let r=h("button","manage-button grey-hover",null,null,n);r.title="Copy card Id",r.addEventListener("click",()=>navigator.clipboard.writeText(e.id)),h("i","fa-regular fa-copy fa-xl",null,null,r),c.appendChild(t)}function b(){let e=document.getElementById("cards-container");(a=!a)?(localStorage.setItem("displayMode","cardsInRows"),e.classList.remove("cards-column-mode"),e.classList.add("cards-row-mode")):(localStorage.setItem("displayMode","cardsInColumns"),e.classList.remove("cards-row-mode"),e.classList.add("cards-column-mode"))}async function E(e){if(r=e||("dark"===r?"light":"dark"),localStorage.setItem("theme",r),["bg","text","input-bg","input-focus-bg","card-bg"].forEach(e=>document.documentElement.style.setProperty(`--${e}-color`,`var(--${r}-mode-${e}-color)`)),o){let t=document.querySelectorAll("body, #search-box, #feature-request-button, .header-container #toggle-cards-display, .header-container #toggle-light-mode, .login-button, .logout-button, .card");for(let n of t)n.classList.add("color-transition");setTimeout(()=>t.forEach(e=>e.classList.remove("color-transition")),300)}}async function L(t){t.preventDefault();let n=await p("vote/new",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t.target.title.value.trim(),description:t.target.description.value.trim(),authorId:e.id})}).then(e=>e.json());return n.error?Swal.fire({icon:"error",title:"Oops...",text:n.error}):(await Swal.fire({icon:"success",title:"Success",text:`Your feature request has been submitted and ${n.approved?"approved":"will be reviewed shortly"}.`}),n.approved)?window.location.reload():void(t.target.reset(),document.getElementById("feature-request-overlay").style.display="none")}async function w(t,n){if(!e?.id)return Swal.fire({icon:"error",title:"Who are you?",text:"You must be logged in to be able to vote!"});let l=await p("vote/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({featureId:t,userId:e?.id})}).then(e=>e.json());if(l.error)return Swal.fire({icon:"error",title:"Oops...",text:l.error});Swal.fire({icon:"success",title:"Success",text:"Your vote has been successfully recorded."}),n.textContent=parseInt(n.textContent)+1}document.getElementById("toggle-cards-display").addEventListener("click",()=>b()),document.getElementById("toggle-color-scheme").addEventListener("click",()=>E()),window.addEventListener("scroll",()=>{t.length>i&&document.documentElement.scrollTop+document.documentElement.clientHeight>=document.documentElement.scrollHeight-15&&f()}),window.addEventListener("resize",()=>{clearTimeout(l),l=setTimeout(()=>{let e=window.innerWidth;d>769&&e<768||d<768&&e>769?window.location.reload():d=e},500)}),document.addEventListener("DOMContentLoaded",async()=>{E(localStorage.getItem("theme")||window.matchMedia("(prefers-color-scheme: light)").matches&&"light"||"dark");let e=window.matchMedia("(max-width: 768px)").matches;a=!e&&"cardsInRows"===localStorage.getItem("displayMode"),await g(e),y(),u.addEventListener("input",({target:e})=>{clearTimeout(n),n=setTimeout(()=>{i=0,f(e.value)},500)}),t=(await p("vote/list").then(e=>e.json()))?.cards?.sort((e,t)=>t.votes-e.votes)||[],c.classList.add(a?"cards-row-mode":"cards-column-mode"),c.style.marginTop=`${s.clientHeight+16}px`,f(),o=!0})})();