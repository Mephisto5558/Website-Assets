"use strict";(()=>{globalThis.window=globalThis;globalThis.importScripts("https://cdn.jsdelivr.net/gh/nastyox/Rando.js@master/code/plain-javascript/2.0.0/rando-min.js");var L=500,T=0;function p(e){let r=Date.now();r<=T+L||(T=r,globalThis.postMessage({type:"progress",message:e}))}function w(e,r,a){return Math.floor(e/a)*a+Math.floor(r/a)}function y(e,r={}){let{findJustOne:a=!0,useRandomSequence:n=!0}=r,o=e.length,i=Math.sqrt(o),g=Array.from({length:o},()=>new Set),u=Array.from({length:o},()=>new Set),c=Array.from({length:o},()=>new Set),b=[];for(let d=0;d<o;d++)for(let t=0;t<o;t++){let s=e[d][t];if(s===0)b.push({rowId:d,colId:t});else{let f=w(d,t,i);g[d].add(s),u[t].add(s),c[f].add(s)}}function S(d){if(d>=b.length)return 1;let{rowId:t,colId:s}=b[d],f=w(t,s,i),m=0;for(let l of n?randoSequence(1,o):Array.from({length:o},(h,E)=>E+1))if(!g[t].has(l)&&!u[s].has(l)&&!c[f].has(l)){e[t][s]=l,g[t].add(l),u[s].add(l),c[f].add(l);let h=S(d+1);if(a){if(h>0)return h}else if(m+=h,m>1)return g[t].delete(l),u[s].delete(l),c[f].delete(l),e[t][s]=0,m;g[t].delete(l),u[s].delete(l),c[f].delete(l),e[t][s]=0}return m}return S(0)}function k(e){let r=e.length,a=[];for(let n=0;n<r;n++)for(let o=0;o<r;o++)e[n][o]!==0&&a.push({rowId:n,colId:o});for(let{rowId:n,colId:o}of randoSequence(a).map(i=>i.value)){let i=e[n][o];if(e[n][o]=0,y(structuredClone(e),{findJustOne:!1,useRandomSequence:!1})>1){e[n][o]=i;continue}return!0}return!1}function I(e,r=0){return Array.from({length:e},()=>Array.from({length:e},()=>r))}function R(e,r){p(`Generating initial full Sudoku. Size: ${e}`);let a=performance.now(),n=I(e);if(!(y(n,{findJustOne:!0,useRandomSequence:!0})>0))return globalThis.postMessage({type:"error",message:"Failed to generate a valid Sudoku board."}),{fullBoard:I(e),board:I(e)};globalThis.postMessage({type:"debug",message:`Took ${performance.now()-a}ms to generate.`});let i=structuredClone(n),g=e**2;p(`Starting to dig holes. Holes to dig: ${r}`);let u=0;for(let c=0;u<r&&c<g;c++)p(`Digging. Holes: ${u}/${r}`),k(i)&&u++;return p(`Dug ${u}/${r} holes.`),{fullBoard:n,board:i}}globalThis.addEventListener("message",e=>{if(e.origin&&e.origin!==globalThis.origin)return console.warn(`Worker received a message from an untrusted origin: "${e.origin}". Ignoring.`);console.log("Worker: Task received from main thread.");let{size:r,holes:a,debugBoard:n}=e.data;globalThis.debugBoard=n;let o=R(r,a);console.log("Worker: Task finished, posting result back."),globalThis.postMessage({type:"result",payload:o})});})();
//# sourceMappingURL=sudoku.worker.js.map
