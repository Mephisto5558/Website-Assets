"use strict";(()=>{globalThis.window=globalThis;globalThis.importScripts("https://cdn.jsdelivr.net/gh/nastyox/Rando.js@master/code/plain-javascript/2.0.0/rando-min.js");var v=500,y=0;function p(e){let t=Date.now();t<=y+v||(y=t,globalThis.postMessage({type:"progress",message:e}))}function I(e,t,a){return Math.floor(e/a)*a+Math.floor(t/a)}function k(e,t={}){let{findJustOne:a=!0,useRandomSequence:n=!0}=t,o=e.length,d=Math.sqrt(o),c=Array.from({length:o},()=>new Set),u=Array.from({length:o},()=>new Set),g=Array.from({length:o},()=>new Set),T=[];for(let i=0;i<o;i++)for(let r=0;r<o;r++){let s=e[i][r];if(s===0)T.push({rowId:i,colId:r});else{let f=I(i,r,d);c[i].add(s),u[r].add(s),g[f].add(s)}}function w(i){if(i>=T.length)return 1;let{rowId:r,colId:s}=T[i],f=I(r,s,d),h=0;for(let l of n?randoSequence(1,o):Array.from({length:o},(m,b)=>b+1))if(!c[r].has(l)&&!u[s].has(l)&&!g[f].has(l)){e[r][s]=l,c[r].add(l),u[s].add(l),g[f].add(l);let m=w(i+1);if(a){if(m>0)return m}else if(h+=m,h>1)return c[r].delete(l),u[s].delete(l),g[f].delete(l),e[r][s]=0,h;c[r].delete(l),u[s].delete(l),g[f].delete(l),e[r][s]=0}return h}return w(0)}function A(e){let t=e.length,a=[];for(let n=0;n<t;n++)for(let o=0;o<t;o++)e[n][o]!==0&&a.push({rowId:n,colId:o});for(let{rowId:n,colId:o}of randoSequence(a).map(d=>d.value)){let d=e[n][o];if(e[n][o]=0,k(structuredClone(e),{findJustOne:!1,useRandomSequence:!1})>1){e[n][o]=d;continue}return!0}return!1}function S(e,t=0){return Array.from({length:e},()=>Array.from({length:e},()=>t))}function M(e,t){p(`Generating initial full Sudoku. Size: ${e}`);let a=performance.now(),n=S(e);if(!(k(n,{findJustOne:!0,useRandomSequence:!0})>0))return globalThis.postMessage({type:"error",message:"Failed to generate a valid Sudoku board."}),{fullBoard:S(e),board:S(e)};globalThis.postMessage({type:"debug",message:`Took ${performance.now()-a}ms to generate.`});let d=structuredClone(n),c=e**2;p(`Starting to dig holes. Holes to dig: ${t}`);let u=0;for(let g=0;u<t&&g<c;g++)p(`Digging. Holes: ${u}/${t}`),A(d)&&u++;return p(`Dug ${u}/${t} holes.`),{fullBoard:n,board:d}}globalThis.addEventListener("message",e=>{if(e.origin&&e.origin!==globalThis.origin)return console.warn(`Worker received a message from an untrusted origin: "${e.origin}". Ignoring.`);console.log("Worker: Task received from main thread.");let{size:t,holes:a,debugBoard:n}=e.data;globalThis.debugBoard=n;let o=M(t,a);console.log("Worker: Task finished, posting result back."),globalThis.postMessage({type:"result",payload:o})});})();
//# sourceMappingURL=sudoku.worker.js.map
