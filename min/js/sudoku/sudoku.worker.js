var v=new Uint32Array(1),R=4294967296;function w(e,o){let r=o-e+1,t=new Array(r);for(let n=0;n<r;n++)t[n]=e+n;return I(t)}function I(e){let o=new Uint32Array(e.length-1);globalThis.crypto.getRandomValues(o);for(let r=e.length-1;r>0;r--){let t=Math.floor(o[r-1]/R*(r+1)),n=e[r];e[r]=e[t],e[t]=n}return e}var B=500,y=0;function b(e){let o=Date.now();o<=y+B||(y=o,globalThis.postMessage({type:"progress",message:e}))}function E(e,o,r){return Math.floor(e/r)*r+Math.floor(o/r)}function A(e,o={}){let{findJustOne:r=!0,useRandomSequence:t=!0}=o,n=e.length,f=Math.sqrt(n),i=Array.from({length:n},()=>new Set),a=Array.from({length:n},()=>new Set),g=Array.from({length:n},()=>new Set),p=[];for(let d=0;d<n;d++)for(let s=0;s<n;s++){let u=e[d][s];if(u===0)p.push({rowId:d,colId:s});else{let c=E(d,s,f);i[d].add(u),a[s].add(u),g[c].add(u)}}function T(d){if(d>=p.length)return 1;let{rowId:s,colId:u}=p[d],c=E(s,u,f),m=0;for(let l of t?w(1,n):Array.from({length:n},(h,L)=>L+1))if(!i[s].has(l)&&!a[u].has(l)&&!g[c].has(l)){e[s][u]=l,i[s].add(l),a[u].add(l),g[c].add(l);let h=T(d+1);if(r){if(h>0)return h}else if(m+=h,m>1)return i[s].delete(l),a[u].delete(l),g[c].delete(l),e[s][u]=0,m;i[s].delete(l),a[u].delete(l),g[c].delete(l),e[s][u]=0}return m}return T(0)}function k(e){let o=e.length,r=[];for(let t=0;t<o;t++)for(let n=0;n<o;n++)e[t][n]!==0&&r.push({rowId:t,colId:n});for(let{rowId:t,colId:n}of I(r)){let f=e[t][n];if(e[t][n]=0,A(structuredClone(e),{findJustOne:!1,useRandomSequence:!1})>1){e[t][n]=f;continue}return!0}return!1}function S(e,o=0){return Array.from({length:e},()=>Array.from({length:e},()=>o))}function M(e,o){b(`Generating initial full Sudoku. Size: ${e}`);let r=performance.now(),t=S(e);if(!(A(t,{findJustOne:!0,useRandomSequence:!0})>0))return globalThis.postMessage({type:"error",message:"Failed to generate a valid Sudoku board."}),{fullBoard:S(e),board:S(e)};globalThis.postMessage({type:"debug",message:`Took ${performance.now()-r}ms to generate.`});let f=structuredClone(t),i=e**2;b(`Starting to dig holes. Holes to dig: ${o}`);let a=0;for(let g=0;a<o&&g<i;g++)b(`Digging. Holes: ${a}/${o}`),k(f)&&a++;return b(`Dug ${a}/${o} holes.`),{fullBoard:t,board:f}}globalThis.addEventListener("message",e=>{if(e.origin&&e.origin!==globalThis.origin)return console.warn(`Worker received a message from an untrusted origin: "${e.origin}". Ignoring.`);console.log("Worker: Task received from main thread.");let{size:o,holes:r,debugBoard:t=!1}=e.data;globalThis.debugBoard=t;let n=M(o,r);console.log("Worker: Task finished, posting result back."),globalThis.postMessage({type:"result",result:n})});
//# sourceMappingURL=sudoku.worker.js.map
