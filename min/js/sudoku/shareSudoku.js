import{updateMinMax}from"./utils.js";import{difficultySlider,sizeOption}from"./constants.js";let BASE=62n,BASE_ALPHABET="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function bigIntToBase62(e){if(0n===e)return"0";let t="";for(;0n<e;e/=BASE)t=BASE_ALPHABET[Number(e%BASE)]+t;return t}function base62ToBigInt(e){return[...e].reduce((e,t)=>e*BASE+BigInt(BASE_ALPHABET.indexOf(t)),0n)}function generateShareURL(e,t){var r,a=BigInt(e.length),o=a+1n;let n=0n;for(r of t.flat())n=n*o+BigInt(r);var i,l,t={s:n,m:BigInt("0b"+e.flat().map(e=>e?"1":"0").join("")),d:a},s=new URL(globalThis.location.href);for([i,l]of Object.entries(t))s.searchParams.set(i,bigIntToBase62(l));return s.toString()}function loadFromShareURL(e){var e=new URLSearchParams(e??globalThis.location.search),r=e.get("d"),a=e.get("s"),e=e.get("m");if(a&&e&&r)try{var o=Number(base62ToBigInt(r)),n=o*o,i=BigInt(o+1),l=base62ToBigInt(e).toString(2).padStart(n,"0");sizeOption.value=Math.sqrt(o),difficultySlider.value=[...l].filter(e=>0==e).length,updateMinMax();let t=base62ToBigInt(a);var s=[];for(let e=0;e<n;e++){var u=t%i;s.push(Number(u)),t/=i}s.reverse();var f=[],h=[];for(let t=0;t<o;t++){var g=[],B=[];for(let e=0;e<o;e++){var c=t*o+e,d=s[c];B.push(d),g.push("1"===l[c]?d:0)}f.push(g),h.push(B)}if(f.length!==o||h.length!==o)throw new Error(`Failed to construct board of size ${o}.`);return{fullBoard:h,board:f}}catch(e){console.error("Failed to parse shared Sudoku URL:",e),globalThis.history.replaceState({},"",globalThis.location.pathname)}}export{generateShareURL,loadFromShareURL};