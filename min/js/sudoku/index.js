import{displayBoard,generateSudoku}from"./generateSudoku.js";globalThis.debug=!0;let DEFAULT_BOARD_SIZE=9,MS_IN_SEC=1e3,SEC_IN_MIN=60,MIN_HOLES=Math.floor(DEFAULT_BOARD_SIZE**2*.2),MAX_HOLES=Math.ceil(DEFAULT_BOARD_SIZE**2*.9);function checkErrors(){var t;for(t of htmlBoard.flat().reduce((r,a)=>{for(let e=0,t=["group","col","row"];e<t.length;e++){var o=Number(a.dataset[t[e]])-1;r[e][o]??=[],r[e][o].type??=t[e],r[e][o].push(a.parentElement)}return r},[[],[],[]]).flat()){var r=Number(t[0].firstChild.dataset[t.type])-1;let e;e="row"==t.type?[t[0].parentElement]:"col"==t.type?[document.querySelectorAll("#sudoku > colgroup > col").item(r)]:document.querySelectorAll(`#sudoku > tbody > tr > td:has(input[data-group='${1+r}']`);r=t.map(e=>Number(e.firstChild.value)||void 0);if(r.length>new Set(r).size+(r.includes(void 0)?r.filter(e=>null==e).length:0))for(var a of e)a.classList.add("error");else for(var o of e)o.classList.remove("error")}}document.documentElement.removeAttribute("style"),globalThis.htmlBoard=[...document.querySelectorAll("#sudoku > tbody > tr")].map(e=>[...e.children].map(e=>e.firstChild));let sudoku=document.querySelector("#sudoku"),regenerateBtn=(sudoku.addEventListener("keypress",e=>{if(" "==e.key&&(e.target.value="",checkErrors()),!/[1-9]/.test(e.key))return e.preventDefault();if(!globalThis.timerInterval){let t=document.querySelector("#timer"),r=performance.now();globalThis.timerInterval=setInterval(()=>{var e=(performance.now()-r)/MS_IN_SEC;t.textContent=String(Math.floor(e/SEC_IN_MIN)).padStart(2,"0")+":"+String(Math.round(e%SEC_IN_MIN)).padStart(2,"0")},MS_IN_SEC)}e.preventDefault(),e.target.value=e.key,checkErrors()}),sudoku.addEventListener("keydown",t=>{var r=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab"];if(r.includes(t.key)){t.preventDefault();var a=(globalThis.boardSize??DEFAULT_BOARD_SIZE)-1;let e;for(;(!e||e.disabled)&&(!e||e.dataset.row!=t.target.dataset.row||e.dataset.col!=t.target.dataset.col);){var o=Number((e??t.target).dataset.row)-1,l=Number((e??t.target).dataset.col)-1;switch(t.key){case r[0]:e=htmlBoard[0==o?a:o-1][l];break;case r[1]:e=htmlBoard[o==a?0:1+o][l];break;case r[2]:e=htmlBoard[o][0==l?a:l-1];break;case r[3]:e=htmlBoard[o][l==a?0:1+l];break;case r[4]:t.shiftKey?(0==o&&0==l&&(e=htmlBoard[a][a]),0==o&&(e=htmlBoard[a][l-1]),e=htmlBoard[o-1][a]):(o==a&&l==a&&(e=htmlBoard[0][0]),o==a&&(e=htmlBoard[o][1+l]),e=htmlBoard[1+o][l])}}e.focus()}}),document.querySelector("#regenerate-btn"));regenerateBtn.addEventListener("click",()=>{var e=rando(MIN_HOLES,MAX_HOLES);console.log(`Size: ${DEFAULT_BOARD_SIZE}, Holes: ${e}/${MAX_HOLES} (min: ${MIN_HOLES})`),displayBoard(generateSudoku(DEFAULT_BOARD_SIZE,e)),checkErrors()}),regenerateBtn.click();