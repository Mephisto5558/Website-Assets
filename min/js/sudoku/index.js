"use strict";(()=>{globalThis.debug=!1;globalThis.debugBoard=globalThis.debug;globalThis.runBench=!1;var j=new Map([[4,"?s=2kCWOHm&m=e7W&d=4"],[9,"?s=1rNvQlP59hY1UJMFE5DX3hwk1qIBLnXS6ilfDGy4IGdhsC&m=bIF2NvxgrvtuEt&d=9"],[16,"?s=hpbjaN1Y0HMLqNcMAz1H6NmKmOMSDZBpjCBHl8dhKhATBXumBoANHGsbnmOEzTkz6ySCcfcC4LMrWKjtcnj7WF611o0NmqeiqasiTMDrNBWf7kUCpC1Yb6ExeVjZ4TopShgiCbnIhyYaAhkHaUko7rwbO5VpQjDjH8lgDvr8EmRs3VS0&m=UqAbrOMIk6BBuY6VoSasyyUP7hzZqaraIZQyp6q0d2J&d=g"],[25,"?s=1rCOSfPzQOeudAZ9m8Oy999CxkkEVldIOJFUQEzxCP0r9UpEghirv6argXEaeTgmFYGzgU8w37AXKDnq1IC0OaZKuAvq2ucit93d8QafCLcltCc3M8iLsyB5YfUYPyTZEe4EDhfYkrlHVw5j5Plk4mYBTbKOX4xZuma0ICk8wlKzNbyotO8cPBfgPywdrp1TQtzS57O0argCrwnk6sXZ1kouvQnvDNzZwTQrhbYXNNnSkhLcEAhqKROi73cr1QEG06ZZwY7SyInKwV10zh0O8vxcKrja7V1VKGi6mIClU82DjhSIiXukRMGreXgDv2ghXfmDNqBDlFhbagGCDjnW7WsTK3vIcGuadHO9PN3MYzCdHNohcJZaT0u7VgCuWCMd9ZO5FiRbkNIq3DPnwam2o6KVfCT3VXIPNmMZjQwBr9jvOzeBCfxlcz4mG4hUQJKsFx6fGurD0SWDHO0Wpx42YGO7SkyMQR6uqDLNyuKW7tbUMF&m=r6qJKq3BQDgjsNIGdaTn0gci7SzX3ietXdo8f974O25AjVapd2FbtnCSkyMKM27thA7WQiYgplCd2l534CNK7AOmHyy5Uz0G2ObKhElWX&d=p"]]),K=9,F=.2,X=.75,E=5,w=1e3;var Z="https://mephisto5558.github.io/Website-Assets/min/js/sudoku/sudoku.worker.js",h=[],be=document.querySelector("#sudoku"),Q=document.querySelector("#difficulty-slider + output"),f=document.querySelector("#loading-container"),Se=[...f.parentElement.children].filter(e=>e!=f),b=[...document.querySelectorAll("#number-overview > tbody > tr > td > span")],L=document.querySelector("#solution-btn"),Y=document.querySelector("#regenerate-btn"),M=document.querySelector("#share-btn"),S=document.querySelector("#difficulty-slider"),T=document.querySelector("#size-option"),V=document.querySelector("#bg-color-switch"),J=document.querySelector("#fg-color-switch"),B=document.querySelector("#timer"),N=document.querySelector("#cancel-loading");var O=document.querySelector("#popup-container > h3"),me=document.querySelector("#popup-container > p");function y(e,t,n){return document.documentElement.style.setProperty(e,t,n)}function R(e){return globalThis.getComputedStyle(document.documentElement).getPropertyValue(e)}function A(e){return e=e.replace("#",""),"#"+(e.length==3?[...e]:e.match(/\w{2}/g)).map(t=>(255-Number.parseInt(t,16)).toString(16).padStart(2,"0")).join("")}async function ee(e){if(globalThis.navigator.clipboard)return await globalThis.navigator.clipboard.writeText(e),v("Saved the link in your clipboard.");let t=document.createElement("textarea");t.value=e,t.classList.add("hidden"),document.body.append(t),t.focus({preventScroll:!0}),t.select();try{if(!document.execCommand("copy"))throw new Error("Did not save");v("Saved the link in your clipboard.")}catch(n){console.error("Could not copy to clipboard using document.execCommand:",n),v("Error","Cold not copy the URL to your clipboard. Please copy it manually from the address bar.")}t.remove()}function q(e,t,n){let r=localStorage.getItem(t);e.value=r??R(e.dataset.cssProperty).trim(),r&&n(r),e.addEventListener("change",a=>{let o=a.target.value;localStorage.setItem(t,o),n(o)})}function te(e,t,n){return Math.floor(e/n)*n+Math.floor(t/n)}function oe(){globalThis.timerInterval=clearInterval(globalThis.timerInterval),B.textContent="00:00",B.setAttribute("datetime","PT0S")}function re(e){let t=new Set,n=a=>{let o=new Map;for(let s of a){let l=Number(s.value);l&&(o.has(l)||o.set(l,[]),o.get(l).push(s))}if([...o.values()].some(s=>s.length>1))for(let s of a)t.add(`${s.dataset.row}-${s.dataset.col}`)};for(let a=0;a<e.length;a++)n(e[a]),n(e.map(o=>o[a]));let r=Math.sqrt(e.length);for(let a=0;a<r;a++)for(let o=0;o<r;o++){let s=[];for(let l=0;l<r;l++)for(let i=0;i<r;i++)s.push(e[a*r+l][o*r+i]);n(s)}for(let a of e.flat())a.parentElement.classList[t.has(`${a.dataset.row}-${a.dataset.col}`)?"add":"remove"]("error")}function C(){let e=Number(T.value)**2||K;T.value=Math.sqrt(e);let t=Math.floor(e**2*F),n=Math.ceil(e**2*X);S.min=t,S.max=n;let r=Number(S.value)||rando(t,n);return S.value=r,Q.textContent=r,{size:e,minHoles:t,maxHoles:n,holes:r}}function v(e,t=e){e!==t&&(O.textContent=e),me.textContent=t,O.parentElement.classList.add("visible"),setTimeout(()=>O.parentElement.classList.remove("visible"),w*3)}function ne(e){let t=Math.sqrt(e);if(!Number.isInteger(t))throw new Error("Size must be quadratic.");console.debug(`Creating HTML board of size ${e}`);let n=document.querySelector("#sudoku");n.innerHTML="";for(let r=0;r<t;r++){let a=document.createElement("colgroup");for(let o=0;o<t;o++)a.append(document.createElement("col"));n.append(a)}for(let r=0;r<t;r++){let a=document.createElement("tbody");for(let o=0;o<t;o++){let s=document.createElement("tr"),l=r*t+o;for(let i=0;i<e;i++){let u=document.createElement("td"),c=document.createElement("input");c.type="number",c.title="",c.required=!0,c.autocomplete="off",c.dataset.row=l+1,c.dataset.col=i+1,c.dataset.group=te(l,i,t)+1,c.ariaLabel=`Row ${l+1}, Column ${i+1}`;let p=document.createElement("div");p.classList.add("notes"),p.append(...Array.from({length:8},(m,d)=>{let g=document.createElement("span");return g.contentEditable="plaintext-only",g.dataset.note=d+ +(d>3)+1,g})),u.append(c),u.append(p),s.append(u)}a.append(s)}n.append(a)}}function ae(e){let t=Math.sqrt(e);if(!Number.isInteger(t))throw new Error("Size must be quadratic.");console.debug(`Creating HTML overview span of size ${e}`);let n=document.querySelector("#number-overview");n.innerHTML="";let r=document.createElement("tbody");for(let a=0;a<t;a++){let o=document.createElement("tr");for(let s=0;s<t;s++){let l=document.createElement("td"),i=document.createElement("span");i.textContent="0",l.textContent=`${t*a+s+1}: `,l.append(i),o.append(l)}r.append(o)}return n.append(r),n}function k(e,t,n,r=!1){for(let o of t.flat())r||o.classList.remove("solution"),r&&!o.disabled&&(o.value&&(o.dataset.val=o.value),o.classList.add("solution")),o.value=(e[Number(o.dataset.row)-1][Number(o.dataset.col)-1]??0)||Number(o.dataset.val)||void 0,o.disabled=r||!!o.value&&!o.dataset.val,r||delete o.dataset.val;let a=e.flat().reduce((o,s)=>(o[s-1]++,o),Array.from({length:e.length},()=>0));for(let[o,s]of a.entries())n[o].textContent=s,n[o].classList[s==e.length?"add":"remove"]("complete")}var U=62n,se="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function pe(e){if(e===0n)return"0";let t="";for(;e>0n;e/=U)t=se[Number(e%U)]+t;return t}function P(e){return[...e].reduce((t,n)=>t*U+BigInt(se.indexOf(n)),0n)}function le(e,t){let n=BigInt(e.length),r=n+1n,a=0n;for(let l of t.flat())a=a*r+BigInt(l);let o={s:a,m:BigInt("0b"+e.flat().map(l=>l?"1":"0").join("")),d:n},s=new URL(globalThis.location.href);for(let[l,i]of Object.entries(o))s.searchParams.set(l,pe(i));return s.toString()}function ie(e){let t=new URLSearchParams(e??globalThis.location.search),n=t.get("d"),r=t.get("s"),a=t.get("m");if(!(!r||!a||!n))try{let o=Number(P(n)),s=o*o,l=BigInt(o+1),i=P(a).toString(2).padStart(s,"0");T.value=Math.sqrt(o),S.value=[...i].filter(d=>d==0).length,C();let u=P(r),c=[];for(let d=0;d<s;d++){let g=u%l;c.push(Number(g)),u/=l}c.reverse();let p=[],m=[];for(let d=0;d<o;d++){let g=[],G=[];for(let x=0;x<o;x++){let $=d*o+x,W=c[$];G.push(W),g.push(i[$]==="1"?W:0)}p.push(g),m.push(G)}if(p.length!==o||m.length!==o)throw new Error(`Failed to construct board of size ${o}.`);return{fullBoard:m,board:p}}catch(o){console.error("Failed to parse shared Sudoku URL:",o),globalThis.history.replaceState({},"",globalThis.location.pathname);return}}document.documentElement.removeAttribute("style");q(V,"sudoku-bg-color",e=>y("--background-color",e));q(J,"sudoku-fg-color",e=>{y("--foreground-color",e),y("--foreground-color-inverted",A(e))});y("--foreground-color-secondary-inverted",A(R("--foreground-color-secondary")));var _,D;function ge(e,t){let n=!1;M.removeEventListener("click",_),L.removeEventListener("click",D),_=async()=>{let r=globalThis.location.search?globalThis.location.href:le(e,t);r!=globalThis.location.href&&globalThis.history.pushState({},"",r),await ee(r)},D=r=>{if(n=!n,n){console.debug("Showing solution."),k(t,h,b,!0),r.target.textContent="Hide Solution";return}console.debug("Hiding solution."),k(e,h,b,!1),r.target.textContent="Show Solution"},M.addEventListener("click",_),L.addEventListener("click",D)}var ce;async function fe(e){let t=await fetch(e).then(n=>n.text());return URL.createObjectURL(new Blob([t],{type:"application/javascript"}))}var I,z;async function he(){ce??=await fe(globalThis.debug?"./sudoku.worker.js":Z);let e=new Worker(ce);return e.addEventListener("message",t=>{if(t.data.type=="cancel")return console.log(`UI: Canceling worker generation${t.data.message?" due to "+t.data.message:""}.`),v("Canceled"),z?.(t.data);if(t.data.type=="result"){console.log("UI: Received result from worker."),I?.(t.data.payload),I=void 0;return}(console[t.data.type=="progress"?"debug":t.data.type]??console.log)("Worker: "+t.data.message),t.data.type=="progress"&&(f.children.namedItem("loading-status").textContent=t.data.message)}),e.addEventListener("error",t=>console.error("Worker:",t)),e}var de=!1,H=!1;async function ue(e,t){if(H)return;if(H=!0,e&&(e.target.disabled=!0),t)N.classList.add("invisible");else{let r=new URL(globalThis.location.href);r.search="",globalThis.history.pushState({},"",r)}let n=setTimeout(()=>{de=!0,f.classList.remove("hiding","hidden")},w/10);try{oe();let r=performance.now(),{size:a,minHoles:o,maxHoles:s,holes:l}=C();globalThis.debugBoard?console.debug("Using debug board."):console.log(`Size: ${a}, Holes: ${l}/${s} (min: ${o})`);let i=ie(globalThis.debugBoard?j.get(a):void 0);if(!i){let p=w*5+a**4;for(let m=1;m<=E;m++){console.log(`UI: Starting generation attempt ${m}/${E}...`),globalThis.sudokuWorker??=await he();try{i=await Promise.race([new Promise((d,g)=>{I=d,z=g,console.log("UI: Posting task to worker..."),globalThis.sudokuWorker.postMessage({size:a,holes:l,debugBoard:globalThis.debugBoard})}),new Promise((d,g)=>setTimeout(()=>g(new Error(`Timeout after ${p}ms`)),p))]);break}catch(d){if(console.warn(`UI: Attempt ${m} failed. Reason: ${d.message}`),f.children.namedItem("loading-status").textContent=`Attempt ${m}/${E} failed. Retrying.`,globalThis.sudokuWorker.terminate(),delete globalThis.sudokuWorker,m>=E)throw new Error("Failed to generate Sudoku after all attempts.")}}}let{fullBoard:u,board:c}=i;u.length!=h.length&&(ne(u.length),h.length=0,h.push(...[...document.querySelectorAll("#sudoku > tbody > tr")].map(p=>[...p.children].map(m=>m.firstChild))),ae(u.length),b.length=0,b.push(...document.querySelectorAll("#number-overview > tbody > tr > td > span"))),y("--sudoku-row-count",u.length),document.documentElement.dataset.sudokuBoxSize=Math.sqrt(u.length),k(c,h,b),re(h),console.debug(`Took ${performance.now()-r}ms to generate and render.`),ge(c,u)}catch(r){if(r?.type==="cancel")return console.log("UI: Generation was successfully canceled.");console.error("An error occurred during Sudoku generation:",r),v("Error","An unexpected error occurred during Sudoku generation. Please try again.")}finally{clearTimeout(n),de?(f.classList.add("hiding"),f.addEventListener("animationend",()=>f.classList.add("hidden"),{once:!0})):f.classList.add("hidden"),H=!1,I=void 0,z=void 0,e&&(e.target.disabled=!1),t&&N.classList.remove("invisible")}}Y.addEventListener("click",ue);ue(void 0,!0);})();
//# sourceMappingURL=index.js.map
