import{displayBoard,generateSudoku}from"./generateSudoku.js";globalThis.debug=!0;let DEFAULT_BOARD_SIZE=9,MS_IN_SEC=1e3,SEC_IN_MIN=60,MIN_HOLES=Math.floor(DEFAULT_BOARD_SIZE**2*.2),MAX_HOLES=Math.ceil(DEFAULT_BOARD_SIZE**2*.9);function checkErrors(){var e,t,r=globalThis.htmlBoard.flat().reduce((r,a)=>{for(let e=0,t=["group","col","row"];e<t.length;e++){var o=Number(a.dataset[t[e]])-1;r[e][o]??=[],r[e][o].type=t[e],r[e][o].push(a.parentElement)}return r},[[],[],[]]).flat(),a=new Set;for(e of r){var o=[...document.querySelectorAll(`#sudoku > tbody > tr > td > input[data-${e.type}='${e[0].firstChild.dataset[e.type]}']`)],l=o.map(e=>Number(e.value)).filter(Boolean);if(l.length>new Set(l).size)for(var n of o)a.add(JSON.stringify(n.dataset))}for(t of globalThis.htmlBoard.flat())a.has(JSON.stringify(t.dataset))?t.parentElement.classList.add("error"):t.parentElement.classList.remove("error")}document.documentElement.removeAttribute("style"),globalThis.htmlBoard=[...document.querySelectorAll("#sudoku > tbody > tr")].map(e=>[...e.children].map(e=>e.firstChild));let sudoku=document.querySelector("#sudoku"),loadingContainer=(sudoku.addEventListener("keypress",e=>{if(e.key==e.target.value)return e.preventDefault();if(" "==e.key&&(e.target.value="",checkErrors()),!/[1-9]/.test(e.key))return e.preventDefault();if(!globalThis.timerInterval){let t=document.querySelector("#timer"),r=performance.now();globalThis.timerInterval=setInterval(()=>{var e=(performance.now()-r)/MS_IN_SEC;t.textContent=String(Math.floor(e/SEC_IN_MIN)).padStart(2,"0")+":"+String(Math.round(e%SEC_IN_MIN)).padStart(2,"0")},MS_IN_SEC)}e.preventDefault(),e.target.value=e.key,checkErrors()}),sudoku.addEventListener("keydown",t=>{if("Backspace"==t.key)return t.target.value="",checkErrors(),t.preventDefault();var r=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab"];if(r.includes(t.key)){t.preventDefault();var a=globalThis.htmlBoard.length-1;let e;for(;(!e||e.disabled)&&(!e||e.dataset.row!=t.target.dataset.row||e.dataset.col!=t.target.dataset.col);){var o=Number((e??t.target).dataset.row)-1,l=Number((e??t.target).dataset.col)-1;switch(t.key){case r[0]:e=globalThis.htmlBoard[0==o?a:o-1][l];break;case r[1]:e=globalThis.htmlBoard[o==a?0:1+o][l];break;case r[2]:e=globalThis.htmlBoard[o][0==l?a:l-1];break;case r[3]:e=globalThis.htmlBoard[o][l==a?0:1+l];break;case r[4]:t.shiftKey?e=0==o&&0==l?globalThis.htmlBoard[a][a]:0<l?globalThis.htmlBoard[o][l-1]:globalThis.htmlBoard[o-1][a]:e=o==a&&l==a?globalThis.htmlBoard[0][0]:o==a?globalThis.htmlBoard[o][1+l]:globalThis.htmlBoard[1+o][l]}}e.focus()}}),document.querySelector("#loading-container")),regenerateBtn=document.querySelector("#regenerate-btn");regenerateBtn.addEventListener("click",()=>{sudoku.parentElement.style.setProperty("visibility","hidden"),loadingContainer.style.removeProperty("display");var e=performance.now(),t=rando(MIN_HOLES,MAX_HOLES);console.log(`Size: ${DEFAULT_BOARD_SIZE}, Holes: ${t}/${MAX_HOLES} (min: ${MIN_HOLES})`),displayBoard(generateSudoku(DEFAULT_BOARD_SIZE,t)),checkErrors(),console.debug(`Took ${performance.now()-e}ms to generate and render.`),loadingContainer.style.setProperty("display","none"),sudoku.parentElement.style.removeProperty("visibility")}),regenerateBtn.click();