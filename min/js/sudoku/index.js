"use strict";(()=>{globalThis.debug=!1;globalThis.debugBoard=globalThis.debug;globalThis.runBench=!1;var X=new Map([[4,"?s=2kCWOHm&m=e7W&d=4"],[9,"?s=1rNvQlP59hY1UJMFE5DX3hwk1qIBLnXS6ilfDGy4IGdhsC&m=bIF2NvxgrvtuEt&d=9"],[16,"?s=hpbjaN1Y0HMLqNcMAz1H6NmKmOMSDZBpjCBHl8dhKhATBXumBoANHGsbnmOEzTkz6ySCcfcC4LMrWKjtcnj7WF611o0NmqeiqasiTMDrNBWf7kUCpC1Yb6ExeVjZ4TopShgiCbnIhyYaAhkHaUko7rwbO5VpQjDjH8lgDvr8EmRs3VS0&m=UqAbrOMIk6BBuY6VoSasyyUP7hzZqaraIZQyp6q0d2J&d=g"],[25,"?s=1rCOSfPzQOeudAZ9m8Oy999CxkkEVldIOJFUQEzxCP0r9UpEghirv6argXEaeTgmFYGzgU8w37AXKDnq1IC0OaZKuAvq2ucit93d8QafCLcltCc3M8iLsyB5YfUYPyTZEe4EDhfYkrlHVw5j5Plk4mYBTbKOX4xZuma0ICk8wlKzNbyotO8cPBfgPywdrp1TQtzS57O0argCrwnk6sXZ1kouvQnvDNzZwTQrhbYXNNnSkhLcEAhqKROi73cr1QEG06ZZwY7SyInKwV10zh0O8vxcKrja7V1VKGi6mIClU82DjhSIiXukRMGreXgDv2ghXfmDNqBDlFhbagGCDjnW7WsTK3vIcGuadHO9PN3MYzCdHNohcJZaT0u7VgCuWCMd9ZO5FiRbkNIq3DPnwam2o6KVfCT3VXIPNmMZjQwBr9jvOzeBCfxlcz4mG4hUQJKsFx6fGurD0SWDHO0Wpx42YGO7SkyMQR6uqDLNyuKW7tbUMF&m=r6qJKq3BQDgjsNIGdaTn0gci7SzX3ietXdo8f974O25AjVapd2FbtnCSkyMKM27thA7WQiYgplCd2l534CNK7AOmHyy5Uz0G2ObKhElWX&d=p"]]),Z=9,Q=.2,Y=.75,T=5,w=1e3;var V="https://mephisto5558.github.io/Website-Assets/min/js/sudoku/sudoku.worker.js",b=[],C=document.querySelector("#sudoku"),K=document.querySelector("#difficulty-slider + output"),p=document.querySelector("#loading-container"),Se=[...p.parentElement.children].filter(e=>e!=p),y=document.querySelector("#number-overview"),h=[...y.querySelectorAll("tbody > tr > td > span")],N=document.querySelector("#solution-btn"),J=document.querySelector("#regenerate-btn"),A=document.querySelector("#share-btn"),E=document.querySelector("#difficulty-slider"),L=document.querySelector("#size-option"),ee=document.querySelector("#bg-color-switch"),te=document.querySelector("#fg-color-switch"),O=document.querySelector("#timer"),R=document.querySelector("#cancel-loading");var P=document.querySelector("#popup-container > h3"),ge=document.querySelector("#popup-container > p");function v(e,t,r){return document.documentElement.style.setProperty(e,t,r)}function q(e){return globalThis.getComputedStyle(document.documentElement).getPropertyValue(e)}function D(e){return e=e.replace("#",""),"#"+(e.length==3?[...e]:e.match(/\w{2}/g)).map(t=>(255-Number.parseInt(t,16)).toString(16).padStart(2,"0")).join("")}async function oe(e){if(globalThis.navigator.clipboard)return await globalThis.navigator.clipboard.writeText(e),S("Saved the link in your clipboard.");let t=document.createElement("textarea");t.value=e,t.classList.add("hidden"),document.body.append(t),t.focus({preventScroll:!0}),t.select();try{if(!document.execCommand("copy"))throw new Error("Did not save");S("Saved the link in your clipboard.")}catch(r){console.error("Could not copy to clipboard using document.execCommand:",r),S("Error","Cold not copy the URL to your clipboard. Please copy it manually from the address bar.")}t.remove()}function U(e,t,r){let n=localStorage.getItem(t);e.value=n??q(e.dataset.cssProperty).trim(),n&&r(n),e.addEventListener("change",a=>{let o=a.target.value;localStorage.setItem(t,o),r(o)})}function ne(e,t,r){return Math.floor(e/r)*r+Math.floor(t/r)}function re(){clearInterval(globalThis.timerInterval),globalThis.timerInterval=void 0,O.textContent="00:00",O.setAttribute("datetime","PT0S")}function ae(e){let t=new Set,r=a=>{let o=new Map;for(let l of a){let i=Number(l.value);i&&(o.has(i)||o.set(i,[]),o.get(i).push(l))}if([...o.values()].some(l=>l.length>1))for(let l of a)t.add(`${l.dataset.row}-${l.dataset.col}`)};for(let a=0;a<e.length;a++)r(e[a]),r(e.map(o=>o[a]));let n=Math.sqrt(e.length);for(let a=0;a<n;a++)for(let o=0;o<n;o++){let l=[];for(let i=0;i<n;i++)for(let d=0;d<n;d++)l.push(e[a*n+i][o*n+d]);r(l)}for(let a of e.flat())a.parentElement.classList.toggle("error",t.has(`${a.dataset.row}-${a.dataset.col}`))}function M(){let e=Number(L.value)**2||Z;L.value=Math.sqrt(e).toString();let t=Math.floor(e**2*Q),r=Math.ceil(e**2*Y);E.min=t.toString(),E.max=r.toString();let n=Number(E.value)||rando(t,r);return E.value=n.toString(),K.textContent=n.toString(),{size:e,minHoles:t,maxHoles:r,holes:n}}function S(e,t=""){e!==t&&(P.textContent=e),ge.textContent=t,P.parentElement.classList.add("visible"),setTimeout(()=>P.parentElement.classList.remove("visible"),w*3)}function le(e){let t=Math.sqrt(e);if(!Number.isInteger(t))throw new Error("Size must be quadratic.");console.debug(`Creating HTML board of size ${e}`),C.innerHTML="";for(let r=0;r<t;r++){let n=document.createElement("colgroup");for(let a=0;a<t;a++)n.append(document.createElement("col"));C.append(n)}for(let r=0;r<t;r++){let n=document.createElement("tbody");for(let a=0;a<t;a++){let o=document.createElement("tr"),l=r*t+a;for(let i=0;i<e;i++){let d=document.createElement("td"),s=document.createElement("input");s.type="number",s.title="",s.required=!0,s.autocomplete="off",s.dataset.row=(l+1).toString(),s.dataset.col=(i+1).toString(),s.dataset.group=(ne(l,i,t)+1).toString(),s.ariaLabel=`Row ${l+1}, Column ${i+1}`;let m=document.createElement("div");m.classList.add("notes"),m.append(...Array.from({length:8},(g,c)=>{let u=document.createElement("span");return u.contentEditable="plaintext-only",u.dataset.note=(c+ +(c>3)+1).toString(),u})),d.append(s),d.append(m),o.append(d)}n.append(o)}C.append(n)}}function ie(e){let t=Math.sqrt(e);if(!Number.isInteger(t))throw new Error("Size must be quadratic.");console.debug(`Creating HTML overview span of size ${e}`),y.innerHTML="";let r=document.createElement("tbody");for(let n=0;n<t;n++){let a=document.createElement("tr");for(let o=0;o<t;o++){let l=document.createElement("td"),i=document.createElement("span");i.textContent="0",l.textContent=`${t*n+o+1}: `,l.append(i),a.append(l)}r.append(a)}return y.append(r),y}function I(e,t,r,n=!1){for(let o of t.flat())n||o.classList.remove("solution"),n&&!o.disabled&&(o.value&&(o.dataset.val=o.value),o.classList.add("solution")),o.value=((e[Number(o.dataset.row)-1]?.[Number(o.dataset.col)-1]??0)||Number(o.dataset.val)||"").toString(),o.disabled=n||!!o.value&&!o.dataset.val,n||delete o.dataset.val;let a=e.flat().reduce((o,l)=>(o[l-1]++,o),Array.from({length:e.length},()=>0));for(let[o,l]of a.entries())r[o].textContent=l.toString(),r[o].classList.toggle("complete",l==e.length)}var $=62n,se="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function fe(e){if(e===0n)return"0";let t="";for(;e>0n;e/=$)t=se[Number(e%$)]+t;return t}function _(e){return[...e].reduce((t,r)=>t*$+BigInt(se.indexOf(r)),0n)}function ue(e,t){let r=BigInt(e.length),n=r+1n,a=0n;for(let i of t.flat())a=a*n+BigInt(i);let o={s:a,m:BigInt("0b"+e.flat().map(i=>i?"1":"0").join("")),d:r},l=new URL(globalThis.location.href);for(let[i,d]of Object.entries(o))l.searchParams.set(i,fe(d));return l.toString()}function de(e){let t=new URLSearchParams(e?.toString()??globalThis.location.search),r=t.get("d"),n=t.get("s"),a=t.get("m");if(!(!n||!a||!r))try{let o=Number(_(r)),l=o*o,i=BigInt(o+1),d=_(a).toString(2).padStart(l,"0");L.value=Math.sqrt(o).toString(),E.value=[...d].filter(u=>Number(u)==0).length.toString(),M();let s=_(n),m=[];for(let u=0;u<l;u++){let f=s%i;m.push(Number(f)),s/=i}m.reverse();let g=[],c=[];for(let u=0;u<o;u++){let f=[],W=[];for(let H=0;H<o;H++){let j=u*o+H,F=m[j];W.push(F),f.push(d[j]==="1"?F:0)}g.push(f),c.push(W)}if(g.length!==o||c.length!==o)throw new Error(`Failed to construct board of size ${o}.`);return{fullBoard:c,board:g}}catch(o){console.error("Failed to parse shared Sudoku URL:",o),globalThis.history.replaceState({},"",globalThis.location.pathname);return}}document.documentElement.removeAttribute("style");U(ee,"sudoku-bg-color",e=>v("--background-color",e));U(te,"sudoku-fg-color",e=>{v("--foreground-color",e),v("--foreground-color-inverted",D(e))});v("--foreground-color-secondary-inverted",D(q("--foreground-color-secondary")));var k,x;function be(e,t){let r=!1;k&&A.removeEventListener("click",k),x&&N.removeEventListener("click",x),k=async()=>{let n=globalThis.location.search?globalThis.location.href:ue(e,t);n!=globalThis.location.href&&globalThis.history.pushState({},"",n),await oe(n)},x=n=>{if(r=!r,r){console.debug("Showing solution."),I(t,b,h,!0),n.target.textContent="Hide Solution";return}console.debug("Hiding solution."),I(e,b,h,!1),n.target.textContent="Show Solution"},A.addEventListener("click",k),N.addEventListener("click",x)}var ce;async function he(e){let t=await fetch(e).then(async r=>r.text());return URL.createObjectURL(new Blob([t],{type:"application/javascript"}))}var B,G;async function Ee(){ce??=await he(globalThis.debug?"./sudoku.worker.js":V);let e=new Worker(ce);return e.addEventListener("message",t=>{if(t.data.type=="cancel")return console.log(`UI: Canceling worker generation${t.data.message?" due to "+t.data.message:""}.`),S("Canceled"),G?.(t.data);if(t.data.type=="result"){console.log("UI: Received result from worker."),B?.(t.data.payload),B=void 0;return}(console[t.data.type=="progress"?"debug":t.data.type]??console.log)("Worker: "+t.data.message),t.data.type=="progress"&&(p.children.namedItem("loading-status").textContent=t.data.message)}),e.addEventListener("error",t=>console.error("Worker:",t)),e}var me=!1,z=!1;async function pe(e,t=!1){if(z)return;if(z=!0,e&&(e.target.disabled=!0),t)R.classList.add("invisible");else{let n=new URL(globalThis.location.href);n.search="",globalThis.history.pushState({},"",n)}let r=setTimeout(()=>{me=!0,p.classList.remove("hiding","hidden")},w/10);try{re();let n=performance.now(),{size:a,minHoles:o,maxHoles:l,holes:i}=M();globalThis.debugBoard?console.debug("Using debug board."):console.log(`Size: ${a}, Holes: ${i}/${l} (min: ${o})`);let d=de(globalThis.debugBoard?X.get(a):void 0);if(!d){let g=w*5+a**4;for(let c=1;c<=T;c++){console.log(`UI: Starting generation attempt ${c}/${T}...`),globalThis.sudokuWorker??=await Ee();try{d=await Promise.race([new Promise((u,f)=>{B=u,G=f,console.log("UI: Posting task to worker..."),globalThis.sudokuWorker.postMessage({size:a,holes:i,debugBoard:globalThis.debugBoard})}),new Promise((u,f)=>void setTimeout(()=>f(new Error(`Timeout after ${g}ms`)),g))]);break}catch(u){if(console.warn(`UI: Attempt ${c} failed. Reason: ${u.message}`),p.children.namedItem("loading-status").textContent=`Attempt ${c}/${T} failed. Retrying.`,globalThis.sudokuWorker.terminate(),delete globalThis.sudokuWorker,c>=T)throw new Error("Failed to generate Sudoku after all attempts.")}}}let{fullBoard:s,board:m}=d;s.length!=b.length&&(le(s.length),b.length=0,b.push(...[...document.querySelectorAll("#sudoku > tbody > tr")].map(g=>[...g.children].map(c=>c.firstChild))),ie(s.length),h.length=0,h.push(...document.querySelectorAll("#number-overview > tbody > tr > td > span"))),v("--sudoku-row-count",s.length),document.documentElement.dataset.sudokuBoxSize=Math.sqrt(s.length),I(m,b,h),ae(b),console.debug(`Took ${performance.now()-n}ms to generate and render.`),be(m,s)}catch(n){if(n?.type==="cancel")return console.log("UI: Generation was successfully canceled.");console.error("An error occurred during Sudoku generation:",n),S("Error","An unexpected error occurred during Sudoku generation. Please try again.")}finally{clearTimeout(r),me?(p.classList.add("hiding"),p.addEventListener("animationend",()=>p.classList.add("hidden"),{once:!0})):p.classList.add("hidden"),z=!1,B=void 0,G=void 0,e&&(e.target.disabled=!1),t&&R.classList.remove("invisible")}}J.addEventListener("click",pe);pe(void 0,!0);})();
//# sourceMappingURL=index.js.map
