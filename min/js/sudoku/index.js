globalThis.debugBoard=!1;var J=new Map([[4,"?s=2kCWOHm&m=e7W&d=4"],[9,"?s=1rNvQlP59hY1UJMFE5DX3hwk1qIBLnXS6ilfDGy4IGdhsC&m=bIF2NvxgrvtuEt&d=9"],[16,"?s=hpbjaN1Y0HMLqNcMAz1H6NmKmOMSDZBpjCBHl8dhKhATBXumBoANHGsbnmOEzTkz6ySCcfcC4LMrWKjtcnj7WF611o0NmqeiqasiTMDrNBWf7kUCpC1Yb6ExeVjZ4TopShgiCbnIhyYaAhkHaUko7rwbO5VpQjDjH8lgDvr8EmRs3VS0&m=UqAbrOMIk6BBuY6VoSasyyUP7hzZqaraIZQyp6q0d2J&d=g"],[25,"?s=1rCOSfPzQOeudAZ9m8Oy999CxkkEVldIOJFUQEzxCP0r9UpEghirv6argXEaeTgmFYGzgU8w37AXKDnq1IC0OaZKuAvq2ucit93d8QafCLcltCc3M8iLsyB5YfUYPyTZEe4EDhfYkrlHVw5j5Plk4mYBTbKOX4xZuma0ICk8wlKzNbyotO8cPBfgPywdrp1TQtzS57O0argCrwnk6sXZ1kouvQnvDNzZwTQrhbYXNNnSkhLcEAhqKROi73cr1QEG06ZZwY7SyInKwV10zh0O8vxcKrja7V1VKGi6mIClU82DjhSIiXukRMGreXgDv2ghXfmDNqBDlFhbagGCDjnW7WsTK3vIcGuadHO9PN3MYzCdHNohcJZaT0u7VgCuWCMd9ZO5FiRbkNIq3DPnwam2o6KVfCT3VXIPNmMZjQwBr9jvOzeBCfxlcz4mG4hUQJKsFx6fGurD0SWDHO0Wpx42YGO7SkyMQR6uqDLNyuKW7tbUMF&m=r6qJKq3BQDgjsNIGdaTn0gci7SzX3ietXdo8f974O25AjVapd2FbtnCSkyMKM27thA7WQiYgplCd2l534CNK7AOmHyy5Uz0G2ObKhElWX&d=p"]]),ee=9,te=.2,ne=.75,C=5,v=1e3,R=60,oe="../../min/js/sudoku/sudoku.worker.js",i=[],f=document.querySelector("#sudoku"),B=document.querySelector("#difficulty-slider + output"),L=document.querySelector("#loading-container"),U=L.querySelector("#loading-status"),M=document.querySelector("#number-overview"),E=[...M.querySelectorAll("tbody > tr > td > span")],$=document.querySelector("#solution-btn"),re=document.querySelector("#regenerate-btn"),_=document.querySelector("#share-btn"),S=document.querySelector("#difficulty-slider"),g=document.querySelector("#size-option"),ae=document.querySelector("#bg-color-switch"),le=document.querySelector("#fg-color-switch"),I=document.querySelector("#timer"),k=document.querySelector("#cancel-loading");var z=document.querySelector("#popup-container > h3"),he=document.querySelector("#popup-container > p");function y(e,t,o){t?document.documentElement.style.setProperty(e,t.toString(),o):document.documentElement.style.removeProperty(e)}function W(e){return globalThis.getComputedStyle(document.documentElement).getPropertyValue(e)}function F(e){return e=e.replace("#",""),"#"+(e.length==3?[...e]:e.match(/\w{2}/g)).map(t=>(255-Number.parseInt(t,16)).toString(16).padStart(2,"0")).join("")}async function se(e){if(globalThis.navigator.clipboard)return await globalThis.navigator.clipboard.writeText(e),T("Saved the link in your clipboard.");let t=document.createElement("textarea");t.value=e,t.classList.add("hidden"),document.body.append(t),t.focus({preventScroll:!0}),t.select();try{if(!document.execCommand("copy"))throw new Error("Did not save");T("Saved the link in your clipboard.")}catch(o){console.error("Could not copy to clipboard using document.execCommand:",o),T("Error","Cold not copy the URL to your clipboard. Please copy it manually from the address bar.")}t.remove()}function G(e,t,o){let n=localStorage.getItem(t);e.value=n??W(e.dataset.cssProperty).trim(),n&&o(n),e.addEventListener("change",a=>{let r=a.target.value;localStorage.setItem(t,r),o(r)})}function ie(e,t,o){return Math.floor(e/o)*o+Math.floor(t/o)}function ue(){let e=performance.now();globalThis.timerInterval=setInterval(()=>{let t=(performance.now()-e)/v,o=Math.floor(t/R).toString().padStart(2,"0"),n=Math.round(t%R).toString().padStart(2,"0");I.textContent=`${o}:${n}`,I.setAttribute("datetime",`PT${o}M${n}S`)},v)}function de(){clearInterval(globalThis.timerInterval),globalThis.timerInterval=void 0,I.textContent="00:00",I.setAttribute("datetime","PT0S")}function N(e,t=!1){let o=E[e-1];if(o.textContent=(Number(o.textContent)+(t?1:-1)).toString(),Number(o.textContent)==E.length){o.classList.add("complete");for(let n of document.querySelectorAll("#sudoku td > .notes > span"))Number(n.textContent)==e&&(n.textContent="",n.classList.remove("visible"))}else o.classList.remove("complete");E.some(n=>!n.classList.contains("complete"))||(clearInterval(globalThis.timerInterval),globalThis.timerInterval=void 0)}function H(e){let t=new Set,o=a=>{let r=new Map;for(let l of a){let s=Number(l.value);s&&(r.has(s)||r.set(s,[]),r.get(s).push(l))}if([...r.values()].some(l=>l.length>1))for(let l of a)t.add(`${l.dataset.row}-${l.dataset.col}`)};for(let a=0;a<e.length;a++)o(e[a]),o(e.map(r=>r[a]));let n=Math.sqrt(e.length);for(let a=0;a<n;a++)for(let r=0;r<n;r++){let l=[];for(let s=0;s<n;s++)for(let c=0;c<n;c++)l.push(e[a*n+s][r*n+c]);o(l)}for(let a of e.flat())a.parentElement.classList.toggle("error",t.has(`${a.dataset.row}-${a.dataset.col}`))}function w(){let e=Number(g.value)**2||ee;g.value=Math.sqrt(e).toString();let t=Math.floor(e**2*te),o=Math.ceil(e**2*ne);S.min=t.toString(),S.max=o.toString();let n=Number(S.value)||rando(t,o);return S.value=n.toString(),B.textContent=n.toString(),{size:e,minHoles:t,maxHoles:o,holes:n}}function T(e,t=""){e!==t&&(z.textContent=e),he.textContent=t,z.parentElement.classList.add("visible"),setTimeout(()=>z.parentElement.classList.remove("visible"),v*3)}function Se(e,t){let o=Number(e.value+t);o>i.length&&(o=Number(t)),e.value&&N(Number(e.value),!1),e.value=o.toString(),N(o,!0)}function Te(e,t){let o;if(e instanceof HTMLSpanElement?o=e:e instanceof HTMLInputElement&&(o=[...e.parentElement.querySelector(".notes").children].find(a=>!a.textContent||a.textContent===t)),!o)return T("Notes full",`Your notes in row ${e.parentElement.firstChild.dataset.row}, column ${e.parentElement.firstChild.dataset.row} are full!
You can edit one by clicking on it.`);let n=Number(o.textContent+t);n>i.length&&(n=Number(t)),o.textContent=n.toString(),o.classList.add("visible")}function j(e){if(f.classList.contains("notes-mode")&&e instanceof HTMLInputElement&&(e=e.parentElement.querySelector(".notes > span.visible:nth-last-child(1 of .visible)")),!!e){if(e instanceof HTMLSpanElement)return e.textContent="",e.classList.remove("visible");N(Number(e.value),!1),e.value=""}}f.addEventListener("keypress",e=>{let t=f.classList.contains("notes-mode");if(e.preventDefault(),e.key==" "&&j(e.target),!!/^[1-9]\d*$/.test(e.key)){if(t&&i.length<10&&e.target instanceof HTMLInputElement){let o=[...e.target.parentElement.querySelector(".notes")?.children??[]].find(n=>n.textContent.trim()==e.key);if(o)return j(o)}if(globalThis.timerInterval||ue(),t)return Te(e.target,e.key);if(e.target instanceof HTMLInputElement)return Se(e.target,e.key)}});f.addEventListener("keydown",e=>{if(e.target instanceof HTMLSpanElement&&e.key==="Enter")return e.target.blur();if(["Backspace","Delete"].includes(e.key))return e.preventDefault(),j(e.target);if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab","Home","End"].includes(e.key))return;e.target instanceof HTMLInputElement||e.preventDefault();let t=i.length-1,o=a=>!a.disabled&&(!e.shiftKey||a.dataset.group==e.target.dataset.group),n;for(e.key=="Home"?n=(e.ctrlKey?i.find(a=>a.some(o)):i[Number(e.target.dataset.row)-1]).find(o):e.key=="End"&&(n=(e.ctrlKey?i.findLast(a=>a.some(o)):i[Number(e.target.dataset.row)-1]).findLast(o));(!n||n.disabled)&&!(n&&n.dataset.row==e.target.dataset.row&&n.dataset.col==e.target.dataset.col);){let a=Number((n??e.target).dataset.row)-1,r=Number((n??e.target).dataset.col)-1;switch(e.key){case"ArrowUp":n=i[a==0?t:a-1][r];break;case"ArrowDown":n=i[a==t?0:a+1][r];break;case"ArrowLeft":n=i[a][r==0?t:r-1];break;case"ArrowRight":n=i[a][r==t?0:r+1];break;case"Tab":if(e.shiftKey){a==0&&r==0?n=i[t][t]:r==0?n=i[a-1][t]:n=i[a][r-1];break}a==t&&r==t?n=i[0][0]:r==t?n=i[a+1][0]:n=i[a][r+1];break;default:break}}n.focus()});f.addEventListener("keyup",e=>{if(e.target instanceof HTMLInputElement)return H(i)});f.addEventListener("blur",e=>{if(e.target instanceof HTMLSpanElement&&!e.target.textContent)return e.target.classList.remove("visible")},!0);document.querySelector("#stepper-up").addEventListener("click",()=>{g.stepUp(),g.dispatchEvent(new Event("change",{bubbles:!0}))});document.querySelector("#stepper-down").addEventListener("click",()=>{g.stepDown(),g.dispatchEvent(new Event("change",{bubbles:!0}))});g.addEventListener("change",w);S.addEventListener("input",e=>B.textContent=e.target.value);k.addEventListener("click",()=>{globalThis.sudokuWorker?.dispatchEvent(new MessageEvent("message",{data:{type:"cancel",message:"user cancel request"}}))});document.querySelector("#toggle-notes-btn").addEventListener("click",e=>{e.target.textContent=`${f.classList.toggle("notes-mode")?"Disable":"Enable"} Notes Mode`});function ce(e){let t=Math.sqrt(e);if(!Number.isInteger(t))throw new Error("Size must be quadratic.");console.debug(`Creating HTML board of size ${e}`),f.innerHTML="";for(let o=0;o<t;o++){let n=document.createElement("colgroup");for(let a=0;a<t;a++)n.append(document.createElement("col"));f.append(n)}for(let o=0;o<t;o++){let n=document.createElement("tbody");for(let a=0;a<t;a++){let r=document.createElement("tr"),l=o*t+a;for(let s=0;s<e;s++){let c=document.createElement("td"),u=document.createElement("input");u.type="number",u.min="1",u.max=e.toString(),u.title="",u.required=!0,u.autocomplete="off",u.dataset.row=(l+1).toString(),u.dataset.col=(s+1).toString(),u.dataset.group=(ie(l,s,t)+1).toString(),u.ariaLabel=`Row ${l+1}, Column ${s+1}`;let b=document.createElement("div");b.classList.add("notes"),b.append(...Array.from({length:8},(h,m)=>{let d=document.createElement("span");return d.contentEditable="plaintext-only",d.dataset.note=(m+ +(m>3)+1).toString(),d})),c.append(u),c.append(b),r.append(c)}n.append(r)}f.append(n)}}function me(e){let t=Math.sqrt(e);if(!Number.isInteger(t))throw new Error("Size must be quadratic.");console.debug(`Creating HTML overview span of size ${e}`),M.innerHTML="";let o=document.createElement("tbody");for(let n=0;n<t;n++){let a=document.createElement("tr");for(let r=0;r<t;r++){let l=document.createElement("td"),s=document.createElement("span");s.textContent="0",l.textContent=`${t*n+r+1}: `,l.append(s),a.append(l)}o.append(a)}return M.append(o),M}function x(e,t,o,n=!1){for(let r of t.flat())n||r.classList.remove("solution"),n&&!r.disabled&&(r.value&&(r.dataset.val=r.value),r.classList.add("solution")),r.value=((e[Number(r.dataset.row)-1]?.[Number(r.dataset.col)-1]??0)||Number(r.dataset.val)||"").toString(),r.disabled=n||!!r.value&&!r.dataset.val,n||delete r.dataset.val;let a=e.flat().reduce((r,l)=>(r[l-1]++,r),Array.from({length:e.length},()=>0));for(let[r,l]of a.entries())o[r].textContent=l.toString(),o[r].classList.toggle("complete",l==e.length)}var X=62n,pe="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function ve(e){if(e===0n)return"0";let t="";for(;e>0n;e/=X)t=pe[Number(e%X)]+t;return t}function K(e){return[...e].reduce((t,o)=>t*X+BigInt(pe.indexOf(o)),0n)}function fe(e,t){let o=BigInt(e.length),n=o+1n,a=0n;for(let s of t.flat())a=a*n+BigInt(s);let r={s:a,m:BigInt("0b"+e.flat().map(s=>s?"1":"0").join("")),d:o},l=new URL(globalThis.location.href);for(let[s,c]of Object.entries(r))l.searchParams.set(s,ve(c));return l.toString()}function ge(e){let t=new URLSearchParams(e?.toString()??globalThis.location.search),o=t.get("d"),n=t.get("s"),a=t.get("m");if(!(!n||!a||!o))try{let r=Number(K(o)),l=r*r,s=BigInt(r+1),c=K(a).toString(2).padStart(l,"0");g.value=Math.sqrt(r).toString(),S.value=[...c].filter(d=>Number(d)==0).length.toString(),w();let u=K(n),b=[];for(let d=0;d<l;d++){let p=u%s;b.push(Number(p)),u/=s}b.reverse();let h=[],m=[];for(let d=0;d<r;d++){let p=[],Z=[];for(let P=0;P<r;P++){let Q=d*r+P,V=b[Q];Z.push(V),p.push(c[Q]==="1"?V:0)}h.push(p),m.push(Z)}if(h.length!==r||m.length!==r)throw new Error(`Failed to construct board of size ${r}.`);return{fullBoard:m,board:h}}catch(r){console.error("Failed to parse shared Sudoku URL:",r),globalThis.history.replaceState({},"",globalThis.location.pathname);return}}document.documentElement.removeAttribute("style");G(ae,"sudoku-bg-color",e=>y("--background-color",e));G(le,"sudoku-fg-color",e=>{y("--foreground-color",e),y("--foreground-color-inverted",F(e))});y("--foreground-color-secondary-inverted",F(W("--foreground-color-secondary")));var A,O;function Le(e,t){let o=!1;A&&_.removeEventListener("click",A),O&&$.removeEventListener("click",O),A=async()=>{let n=globalThis.location.search?globalThis.location.href:fe(e,t);n!=globalThis.location.href&&globalThis.history.pushState({},"",n),await se(n)},O=n=>{if(n.target instanceof HTMLButtonElement){if(o=!o,o){console.debug("Showing solution."),x(t,i,E,!0),n.target.textContent="Hide Solution";return}console.debug("Hiding solution."),x(e,i,E,!1),n.target.textContent="Show Solution"}},_.addEventListener("click",A),$.addEventListener("click",O)}var q,D;function ye(){let e=new Worker(oe);return e.addEventListener("message",t=>{switch(t.data.type){case"cancel":return console.log(`UI: Canceling worker generation${t.data.message?" due to "+t.data.message:""}.`),T("Canceled"),D?.(t.data.message);case"result":console.log("UI: Received result from worker."),q?.(t.data.result),q=void 0;return;case"progress":U.textContent=t.data.message,t.data.type="debug";default:console[t.data.type]("Worker: "+t.data.message)}}),e.addEventListener("error",t=>D?.(t.error)),e}var be=!1,Y=!1;async function Ee(e,t=!1){if(Y)return;if(Y=!0,e?.target instanceof HTMLButtonElement&&(e.target.disabled=!0),t)k.classList.add("invisible");else{let n=new URL(globalThis.location.href);n.search="",globalThis.history.pushState({},"",n)}let o=setTimeout(()=>{be=!0,L.classList.remove("hiding","hidden")},v/10);try{de();let n=performance.now(),{size:a,minHoles:r,maxHoles:l,holes:s}=w();globalThis.debugBoard?console.debug("Using debug board."):console.log(`Size: ${a}, Holes: ${s}/${l} (min: ${r})`);let c=ge(globalThis.debugBoard?J.get(a):void 0);if(!c){let h=v*5+a**4;for(let m=1;m<=C;m++){console.log(`UI: Starting generation attempt ${m}/${C}...`),globalThis.sudokuWorker??=ye();try{c=await Promise.race([new Promise((d,p)=>{q=d,D=p,console.log("UI: Posting task to worker..."),globalThis.sudokuWorker.postMessage({size:a,holes:s,debugBoard:globalThis.debugBoard})}),new Promise((d,p)=>void setTimeout(()=>p(new Error(`Timeout after ${h}ms`)),h))]);break}catch(d){let p=d instanceof Error?d:new Error(String(d));if(p.message!="user cancel request"&&(console.warn(`UI: Attempt ${m} failed. Reason: ${p.message}`),U.textContent=`Attempt ${m}/${C} failed. Retrying.`),globalThis.sudokuWorker.terminate(),globalThis.sudokuWorker=void 0,p.message=="user cancel request")break;if(m>=C)throw new Error("Failed to generate Sudoku after all attempts.",{cause:d})}}}if(!c)return;let{fullBoard:u,board:b}=c;u.length!=i.length&&(ce(u.length),i.length=0,i.push(...document.querySelectorAll("#sudoku > tbody > tr").values().map(h=>[...h.children].map(m=>m.firstChild))),me(u.length),E.length=0,E.push(...document.querySelectorAll("#number-overview > tbody > tr > td > span"))),y("--sudoku-row-count",u.length),document.documentElement.dataset.sudokuBoxSize=Math.sqrt(u.length).toString(),x(b,i,E),H(i),console.debug(`Took ${performance.now()-n}ms to generate and render.`),Le(b,u)}catch(n){console.error("An error occurred during Sudoku generation:",n),T("Error","An unexpected error occurred during Sudoku generation. Please try again.")}finally{clearTimeout(o),be?(L.classList.add("hiding"),L.addEventListener("animationend",()=>L.classList.add("hidden"),{once:!0})):L.classList.add("hidden"),Y=!1,q=void 0,D=void 0,e?.target instanceof HTMLButtonElement&&(e.target.disabled=!1),t&&k.classList.remove("invisible")}}re.addEventListener("click",Ee);Ee(void 0,!0);
//# sourceMappingURL=index.js.map
