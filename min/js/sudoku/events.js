import{cancelBtn,difficultyOutput,difficultySlider,htmlBoard,sizeOption,sudoku}from"./constants.js";import{checkErrors,startTimer,updateNumberOverviewSpan,updateMinMax,sendPopup}from"./utils.js";export default void 0;function handleNormalInput(e,t){let a=Number(e.value+t);a>htmlBoard.length&&(a=Number(t)),e.value&&updateNumberOverviewSpan(Number(e.value),!1),e.value=a,updateNumberOverviewSpan(a,!0),checkErrors(htmlBoard)}function handleNotesInput(e,t){let a;var r;if("SPAN"==e.tagName?a=e:"INPUT"==e.tagName&&(r=[...e.parentElement.querySelector(".notes").children],a=r.find(e=>!e.textContent||e.textContent===t)),!a)return sendPopup("Notes full",`Your notes in row ${e.parentElement.firstChild.dataset.row}, column ${e.parentElement.firstChild.dataset.row} are full!
You can edit one by clicking on it.`);let n=Number(a.textContent+t);n>htmlBoard.length&&(n=Number(t)),a.textContent=n,a.classList.add("visible")}function clearNote(e){e.textContent="",e.classList.remove("visible")}function clearInput(e){updateNumberOverviewSpan(Number(e.value),!1),e.value="",checkErrors(htmlBoard)}sudoku.addEventListener("keypress",e=>{e.preventDefault();var t=sudoku.classList.contains("notes-mode");if(" "===e.key){if(t&&e.target.matches(".notes > span"))return clearNote(e.target);if(!t&&e.target.matches("input")&&e.target.value)return clearInput(e.target)}if(/^[1-9]\d*$/.test(e.key))return globalThis.timerInterval||startTimer(),t?handleNotesInput(e.target,e.key):e.target.matches("input")?handleNormalInput(e.target,e.key):void 0});let eventKeys=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab","Home","End","Backspace"];sudoku.addEventListener("keydown",a=>{if(eventKeys.includes(a.key)&&"INPUT"!=a.target.tagName&&a.preventDefault(),"Enter"===a.key&&"SPAN"==a.target.tagName)return a.target.blur();if("INPUT"==a.target.tagName&&eventKeys.includes(a.key)){if(a.key==eventKeys[7])return clearInput(a.target);a.preventDefault();var t=htmlBoard.length-1;let e;if(a.key==eventKeys[5]||a.key==eventKeys[6]){var r=a.key==eventKeys[5]?"find":"findLast";let t=e=>!(e.disabled||a.shiftKey&&e.dataset.group!=a.target.dataset.group);e=(a.ctrlKey?htmlBoard[r](e=>e.some(t)):htmlBoard[Number(a.target.dataset.row)-1])[r](t)}for(;(!e||e.disabled)&&(!e||e.dataset.row!=a.target.dataset.row||e.dataset.col!=a.target.dataset.col);){var n=Number((e??a.target).dataset.row)-1,s=Number((e??a.target).dataset.col)-1;switch(a.key){case eventKeys[0]:e=htmlBoard[0==n?t:n-1][s];break;case eventKeys[1]:e=htmlBoard[n==t?0:1+n][s];break;case eventKeys[2]:e=htmlBoard[n][0==s?t:s-1];break;case eventKeys[3]:e=htmlBoard[n][s==t?0:1+s];break;case eventKeys[4]:a.shiftKey?e=0==n&&0==s?htmlBoard[t][t]:0==s?htmlBoard[n-1][t]:htmlBoard[n][s-1]:e=n==t&&s==t?htmlBoard[0][0]:s==t?htmlBoard[1+n][0]:htmlBoard[n][1+s]}}e.focus()}}),sudoku.addEventListener("blur",e=>{if("SPAN"==e.target.tagName&&!e.target.textContent)return e.target.classList.remove("visible")},!0),document.querySelector("#stepper-up").addEventListener("click",()=>{sizeOption.stepUp(),sizeOption.dispatchEvent(new Event("change",{bubbles:!0}))}),document.querySelector("#stepper-down").addEventListener("click",()=>{sizeOption.stepDown(),sizeOption.dispatchEvent(new Event("change",{bubbles:!0}))}),sizeOption.addEventListener("change",updateMinMax),difficultySlider.addEventListener("input",e=>difficultyOutput.textContent=e.target.value),cancelBtn.addEventListener("click",()=>{globalThis.sudokuWorker.terminate(),globalThis.sudokuWorker.dispatchEvent(new MessageEvent("message",{data:{type:"cancel",message:"user request"}})),delete globalThis.sudokuWorker}),document.querySelector("#toggle-notes-btn").addEventListener("click",e=>{e.target.textContent=`${sudoku.classList.toggle("notes-mode")?"Disable":"Enable"} Notes Mode`});